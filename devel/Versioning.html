

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Versioning &#8212; SQLObject 3.3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Views and SQLObjects" href="Views.html" />
    <link rel="prev" title="Inheritance" href="Inheritance.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Views.html" title="Views and SQLObjects"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Inheritance.html" title="Inheritance"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SQLObject 3.3.0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Versioning</a><ul>
<li><a class="reference internal" href="#why">Why</a></li>
<li><a class="reference internal" href="#how">How</a></li>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li><a class="reference internal" href="#version-tables">Version Tables</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Inheritance.html"
                        title="previous chapter">Inheritance</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Views.html"
                        title="next chapter">Views and SQLObjects</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Versioning.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#versioning" id="id2">Versioning</a><ul>
<li><a class="reference internal" href="#why" id="id3">Why</a></li>
<li><a class="reference internal" href="#how" id="id4">How</a></li>
<li><a class="reference internal" href="#inheritance" id="id5">Inheritance</a></li>
<li><a class="reference internal" href="#version-tables" id="id6">Version Tables</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="versioning">
<h1><a class="toc-backref" href="#id2">Versioning</a><a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why">
<h2><a class="toc-backref" href="#id3">Why</a><a class="headerlink" href="#why" title="Permalink to this headline">¶</a></h2>
<p>You have a table where rows can be altered, such as a table of wiki
pages.  You want to retain a history of changes for auditing, backup,
or tracking purposes.</p>
<p>You could write a decorator that stores old versions and manage all
access to this object through it.  Or you could take advantage of the
event system in SQLObject 0.8+ and just catch row accesses to the
object.  SQLObject&#8217;s versioning module does this for you.  And it even
works with inheritance!</p>
</div>
<div class="section" id="how">
<h2><a class="toc-backref" href="#id4">How</a><a class="headerlink" href="#how" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s how to set it up:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">SQLObject</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringCol</span><span class="p">()</span>
    <span class="n">versions</span> <span class="o">=</span> <span class="n">Versioning</span><span class="p">()</span>
</pre></div>
</div>
<p>To use it, just create an instance as usual:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;fleem&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then make some changes and check out the results:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;morx&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">mc</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fleem&#39;</span>
</pre></div>
</div>
<p>You can also restore to a previous version:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mc</span><span class="o">.</span><span class="n">versions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">mc</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fleem&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritance">
<h2><a class="toc-backref" href="#id5">Inheritance</a><a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h2>
<p>There are three ways versioning can be used with <a class="reference external" href="Inheritance.html">inheritance</a>:</p>
<ol class="arabic">
<li><p class="first">Parent versioned, children unversioned:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringCol</span><span class="p">()</span>
    <span class="n">versions</span> <span class="o">=</span> <span class="n">Versioning</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">toy</span> <span class="o">=</span> <span class="n">StringCol</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
<p>In this case, when changes are made to an instance of Base, new
versions are created.  But when changes are made to an instance of
Child, no new versions are created.</p>
<ol class="arabic simple" start="2">
<li>Children versioned, parents unversioned.</li>
</ol>
<p>In this case, when changes are made to an instance of Child, new
versions are created.  But when changes are made to an instance of
Base, no new versions are created.  The version data for Child
contains all of the columns from child and from base, so that a full
restore is possible.</p>
<ol class="arabic simple" start="3">
<li>Both children and parents versioned.</li>
</ol>
<p>In this case, changes to either Child or Base instances create new
versions, but in different tables.  Child versions still contain all
Base data, and a change to a Child only creates a new Child version, not
a new Base version.</p>
</div>
<div class="section" id="version-tables">
<h2><a class="toc-backref" href="#id6">Version Tables</a><a class="headerlink" href="#version-tables" title="Permalink to this headline">¶</a></h2>
<p>Versions are stored in a special table which is created when the table
for a versioned class is created.  Version tables are not altered when
the main table is altered, so if you add a column to your main class,
you will need to manually add the column to your version table.</p>
<a class="reference external image-reference" href="https://sourceforge.net/projects/sqlobject"><img alt="Get SQLObject at SourceForge.net. Fast, secure and Free Open Source software downloads" class="noborder align-center" src="https://sourceforge.net/sflogo.php?group_id=74338&amp;type=10" style="width: 80px; height: 15px;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Views.html" title="Views and SQLObjects"
             >next</a> |</li>
        <li class="right" >
          <a href="Inheritance.html" title="Inheritance"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SQLObject 3.3.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2017, Ian Bicking and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>