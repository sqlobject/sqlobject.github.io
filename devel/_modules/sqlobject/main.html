

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sqlobject.main &#8212; SQLObject 3.2.0a1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.2.0a1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sqlobject.main</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SQLObject</span>
<span class="sd">---------</span>

<span class="sd">:author: Ian Bicking &lt;ianb@colorstudy.com&gt;</span>

<span class="sd">SQLObject is a object-relational mapper.  See SQLObject.html or</span>
<span class="sd">SQLObject.rst for more.</span>

<span class="sd">With the help by Oleg Broytman and many other contributors.</span>
<span class="sd">See Authors.rst.</span>

<span class="sd">This program is free software; you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU Lesser General Public License as</span>
<span class="sd">published by the Free Software Foundation; either version 2.1 of the</span>
<span class="sd">License, or (at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU Lesser General Public</span>
<span class="sd">License along with this program; if not, write to the Free Software</span>
<span class="sd">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301,</span>
<span class="sd">USA.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sqlbuilder</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">dbconnection</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">col</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">styles</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">joins</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">index</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">classregistry</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">declarative</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">events</span>
<span class="kn">from</span> <span class="nn">.sresults</span> <span class="k">import</span> <span class="n">SelectResults</span>
<span class="kn">from</span> <span class="nn">.util.threadinglocal</span> <span class="k">import</span> <span class="n">local</span>
<span class="kn">from</span> <span class="nn">sqlobject.compat</span> <span class="k">import</span> <span class="n">PY2</span><span class="p">,</span> <span class="n">with_metaclass</span><span class="p">,</span> <span class="n">string_type</span><span class="p">,</span> <span class="n">unicode_type</span>

<span class="k">if</span> <span class="p">((</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span> <span class="ow">or</span> \
   <span class="p">((</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))):</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;SQLObject requires Python 2.6, 2.7 or 3.4+&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span><span class="p">:</span>
    <span class="c1"># alias for python 3 compatability</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This thread-local storage is needed for RowCreatedSignals. It gathers</span>
<span class="sd">code-blocks to execute _after_ the whole hierachy of inherited SQLObjects</span>
<span class="sd">is created. See SQLObject._create</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">NoDefault</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">NoDefault</span>


<div class="viewcode-block" id="SQLObjectNotFound"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObjectNotFound">[docs]</a><span class="k">class</span> <span class="nc">SQLObjectNotFound</span><span class="p">(</span><span class="ne">LookupError</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="SQLObjectIntegrityError"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObjectIntegrityError">[docs]</a><span class="k">class</span> <span class="nc">SQLObjectIntegrityError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="k">def</span> <span class="nf">makeProperties</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a dictionary of methods and finds</span>
<span class="sd">    methods named like:</span>
<span class="sd">    * _get_attr</span>
<span class="sd">    * _set_attr</span>
<span class="sd">    * _del_attr</span>
<span class="sd">    * _doc_attr</span>
<span class="sd">    Except for _doc_attr, these should be methods.  It</span>
<span class="sd">    then creates properties from these methods, like</span>
<span class="sd">    property(_get_attr, _set_attr, _del_attr, _doc_attr).</span>
<span class="sd">    Missing methods are okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">setFunc</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">setFunc</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="n">props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_set_&#39;</span><span class="p">):</span>
            <span class="n">props</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">5</span><span class="p">:],</span> <span class="p">{})[</span><span class="s1">&#39;set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_get_&#39;</span><span class="p">):</span>
            <span class="n">props</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">5</span><span class="p">:],</span> <span class="p">{})[</span><span class="s1">&#39;get&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_del_&#39;</span><span class="p">):</span>
            <span class="n">props</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">5</span><span class="p">:],</span> <span class="p">{})[</span><span class="s1">&#39;del&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_doc_&#39;</span><span class="p">):</span>
            <span class="n">props</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="mi">5</span><span class="p">:],</span> <span class="p">{})[</span><span class="s1">&#39;doc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">setters</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">setters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;doc&#39;</span> <span class="ow">in</span> <span class="n">setters</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;I tried to set the property </span><span class="si">%r</span><span class="s2">, but it was &quot;</span>
                    <span class="s2">&quot;already set, as a method (</span><span class="si">%r</span><span class="s2">).  Methods have &quot;</span>
                    <span class="s2">&quot;significantly different semantics than properties, &quot;</span>
                    <span class="s2">&quot;and this may be a sign of a bug in your code.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]))</span>
            <span class="k">continue</span>
        <span class="n">setFunc</span><span class="p">(</span><span class="n">var</span><span class="p">,</span>
                <span class="nb">property</span><span class="p">(</span><span class="n">setters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">),</span> <span class="n">setters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">),</span>
                         <span class="n">setters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">),</span> <span class="n">setters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">unmakeProperties</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">delFunc</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
            <span class="k">del</span> <span class="n">obj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delFunc</span> <span class="o">=</span> <span class="nb">delattr</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">fget</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">fset</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">fdel</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="ow">and</span> <span class="n">prop</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">delFunc</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
                    <span class="k">break</span>


<span class="k">def</span> <span class="nf">findDependencies</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">registry</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">depends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">classregistry</span><span class="o">.</span><span class="n">registry</span><span class="p">(</span><span class="n">registry</span><span class="p">)</span><span class="o">.</span><span class="n">allClasses</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">findDependantColumns</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
            <span class="n">depends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="n">joins</span><span class="o">.</span><span class="n">SORelatedJoin</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="n">join</span><span class="o">.</span><span class="n">otherClassName</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">depends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">depends</span>


<span class="k">def</span> <span class="nf">findDependantColumns</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
    <span class="n">depends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_col</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_col</span><span class="o">.</span><span class="n">foreignKey</span> <span class="o">==</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">_col</span><span class="o">.</span><span class="n">cascade</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">depends</span>


<span class="k">def</span> <span class="nf">_collectAttributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span> <span class="n">look_for_class</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Finds all attributes in `new_attrs` that are instances of</span>
<span class="sd">    `look_for_class`. The ``.name`` attribute is set for any matching objects.</span>
<span class="sd">    Returns them as a list.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">look_for_class</span><span class="p">):</span>
            <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">attr</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">CreateNewSQLObject</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dummy singleton to use in place of an ID, to signal we want</span>
<span class="sd">    a new object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="sqlmeta"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta">[docs]</a><span class="k">class</span> <span class="nc">sqlmeta</span><span class="p">(</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">declarative</span><span class="o">.</span><span class="n">DeclarativeMeta</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object is the object we use to keep track of all sorts of</span>
<span class="sd">    information.  Subclasses are made for each SQLObject subclass</span>
<span class="sd">    (dynamically if necessary), and instances are created to go</span>
<span class="sd">    alongside every SQLObject instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">idName</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">idSequence</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># This function is used to coerce IDs into the proper format,</span>
    <span class="c1"># so you should replace it with str, or another function, if you</span>
    <span class="c1"># aren&#39;t using integer IDs</span>
    <span class="n">idType</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">style</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lazyUpdate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">defaultOrder</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cacheValues</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">registry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fromDatabase</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Default is false, but we set it to true for the *instance*</span>
    <span class="c1"># when necessary: (bad clever? maybe)</span>
    <span class="n">expired</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># This is a mapping from column names to SOCol (or subclass)</span>
    <span class="c1"># instances:</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">columnList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># This is a mapping from column names to Col (or subclass)</span>
    <span class="c1"># instances; these objects don&#39;t have the logic that the SOCol</span>
    <span class="c1"># objects do, and are not attached to this class closely.</span>
    <span class="n">columnDefinitions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># These are lists of the join and index objects:</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indexDefinitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">joins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">joinDefinitions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># These attributes shouldn&#39;t be shared with superclasses:</span>
    <span class="n">_unshared_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="s1">&#39;childName&#39;</span><span class="p">]</span>

    <span class="c1"># These are internal bookkeeping attributes; the class-level</span>
    <span class="c1"># definition is a default for the instances, instances will</span>
    <span class="c1"># reset these values.</span>

    <span class="c1"># When an object is being created, it has an instance</span>
    <span class="c1"># variable _creating, which is true.  This way all the</span>
    <span class="c1"># setters can be captured until the object is complete,</span>
    <span class="c1"># and then the row is inserted into the database.  Once</span>
    <span class="c1"># that happens, _creating is deleted from the instance,</span>
    <span class="c1"># and only the class variable (which is always false) is</span>
    <span class="c1"># left.</span>
    <span class="n">_creating</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_obsolete</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Sometimes an intance is attached to a connection, not</span>
    <span class="c1"># globally available.  In that case, self.sqlmeta._perConnection</span>
    <span class="c1"># will be true.  It&#39;s false by default:</span>
    <span class="n">_perConnection</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Inheritance definitions:</span>
    <span class="n">parentClass</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># A reference to the parent class</span>
    <span class="n">childClasses</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># References to child classes, keyed by childName</span>
    <span class="n">childName</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Class name for inheritance child object creation</span>

    <span class="c1"># Does the row require syncing?</span>
    <span class="n">dirty</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Default encoding for UnicodeCol&#39;s</span>
    <span class="n">dbEncoding</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__classinit__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unshared_attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_attrs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">declarative</span><span class="o">.</span><span class="n">setup_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.send"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">events</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.setClass"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.setClass">[docs]</a>    <span class="k">def</span> <span class="nf">setClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">soClass</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span> <span class="o">=</span> <span class="n">soClass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">style</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">styles</span><span class="o">.</span><span class="n">defaultStyle</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">style</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">style</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">pythonClassToDBTable</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">idName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">idName</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">idForTable</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>

        <span class="c1"># plainSetters are columns that haven&#39;t been overridden by the</span>
        <span class="c1"># user, so we can contact the database directly to set them.</span>
        <span class="c1"># Note that these can&#39;t set these in the SQLObject class</span>
        <span class="c1"># itself, because they specific to this subclass of SQLObject,</span>
        <span class="c1"># and cannot be shared among classes.</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainSetters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainGetters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainForeignSetters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainForeignGetters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainJoinGetters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainJoinAdders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_plainJoinRemovers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># This is a dictionary of columnName: columnObject</span>
        <span class="c1"># None of these objects can be shared with superclasses</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">columnList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># These, however, can be shared:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">columnDefinitions</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">indexDefinitions</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">indexDefinitions</span><span class="p">[:]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">joins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">joinDefinitions</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">joinDefinitions</span><span class="p">[:]</span></div>

    <span class="c1">############################################################</span>
    <span class="c1"># Adding special values, like columns and indexes</span>
    <span class="c1">############################################################</span>

    <span class="c1">########################################</span>
    <span class="c1"># Column handling</span>
    <span class="c1">########################################</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.addColumn"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.addColumn">[docs]</a>    <span class="k">def</span> <span class="nf">addColumn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">columnDef</span><span class="p">,</span> <span class="n">changeSchema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">AddColumnSignal</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                 <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">columnDef</span><span class="p">,</span> <span class="n">changeSchema</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span>
        <span class="k">del</span> <span class="bp">cls</span>
        <span class="n">column</span> <span class="o">=</span> <span class="n">columnDef</span><span class="o">.</span><span class="n">withClass</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;The &#39;id&#39; column is implicit, and should not be defined as &quot;</span>
            <span class="s2">&quot;a column&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;The class </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> already has a column </span><span class="si">%r</span><span class="s2"> (</span><span class="si">%r</span><span class="s2">), you cannot &quot;</span>
            <span class="s2">&quot;add the column </span><span class="si">%r</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">soClass</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="n">soClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
               <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">columnDef</span><span class="p">))</span>
        <span class="c1"># Collect columns from the parent classes to test</span>
        <span class="c1"># if the column is not in a parent class</span>
        <span class="n">parent_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">soClass</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s2">&quot;sqlmeta&quot;</span><span class="p">):</span>
                <span class="n">parent_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">parent_columns</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;childName&quot;</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;The class </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> already has a variable or method </span><span class="si">%r</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;you cannot add the column </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">soClass</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="n">soClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">columnDef</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span>
        <span class="c1"># A stable-ordered version of the list...</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

        <span class="c1">###################################################</span>
        <span class="c1"># Create the getter function(s).  We&#39;ll start by</span>
        <span class="c1"># creating functions like _SO_get_columnName,</span>
        <span class="c1"># then if there&#39;s no function named _get_columnName</span>
        <span class="c1"># we&#39;ll alias that to _SO_get_columnName.  This</span>
        <span class="c1"># allows a sort of super call, even though there&#39;s</span>
        <span class="c1"># no superclass that defines the database access.</span>
        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">cacheValues</span><span class="p">:</span>
            <span class="c1"># We create a method here, which is just a function</span>
            <span class="c1"># that takes &quot;self&quot; as the first argument.</span>
            <span class="n">getter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                <span class="s1">&#39;lambda self: self._SO_loadValue(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we aren&#39;t caching values, we just call the</span>
            <span class="c1"># function _SO_getValue, which fetches from the</span>
            <span class="c1"># database.</span>
            <span class="n">getter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;lambda self: self._SO_getValue(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawGetterName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">getter</span><span class="p">)</span>

        <span class="c1"># Here if the _get_columnName method isn&#39;t in the</span>
        <span class="c1"># definition, we add it with the default</span>
        <span class="c1"># _SO_get_columnName definition.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;childName&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">getter</span><span class="p">)</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainGetters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#################################################</span>
        <span class="c1"># Create the setter function(s)</span>
        <span class="c1"># Much like creating the getters, we will create</span>
        <span class="c1"># _SO_set_columnName methods, and then alias them</span>
        <span class="c1"># to _set_columnName if the user hasn&#39;t defined</span>
        <span class="c1"># those methods themself.</span>

        <span class="c1"># @@: This is lame; immutable right now makes it unsettable,</span>
        <span class="c1"># making the table read-only</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">column</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
            <span class="c1"># We start by just using the _SO_setValue method</span>
            <span class="n">setter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                <span class="s1">&#39;lambda self, val: self._SO_setValue&#39;</span>
                <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">, val, self.</span><span class="si">%s</span><span class="s1">, self.</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                    <span class="s1">&#39;_SO_from_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;_SO_to_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_from_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">from_python</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_to_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">to_python</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawSetterName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">setter</span><span class="p">)</span>
            <span class="c1"># Then do the aliasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;childName&#39;</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">setter</span><span class="p">)</span>
                <span class="c1"># We keep track of setters that haven&#39;t been</span>
                <span class="c1"># overridden, because we can combine these</span>
                <span class="c1"># set columns into one SQL UPDATE query.</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainSetters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">##################################################</span>
        <span class="c1"># Here we check if the column is a foreign key, in</span>
        <span class="c1"># which case we need to make another method that</span>
        <span class="c1"># fetches the key and constructs the sister</span>
        <span class="c1"># SQLObject instance.</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">:</span>

            <span class="c1"># We go through the standard _SO_get_columnName deal</span>
            <span class="c1"># we&#39;re giving the object, not the ID of the</span>
            <span class="c1"># object this time:</span>
            <span class="n">origName</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">origName</span>
            <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">cacheValues</span><span class="p">:</span>
                <span class="c1"># self._SO_class_className is a reference</span>
                <span class="c1"># to the class in question.</span>
                <span class="n">getter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                    <span class="s1">&#39;lambda self: self._SO_foreignKey&#39;</span>
                    <span class="s1">&#39;(self._SO_loadValue(</span><span class="si">%r</span><span class="s1">), self._SO_class_</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span>
                     <span class="n">column</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">and</span> <span class="nb">repr</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">refColumn</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Same non-caching version as above.</span>
                <span class="n">getter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                    <span class="s1">&#39;lambda self: self._SO_foreignKey&#39;</span>
                    <span class="s1">&#39;(self._SO_getValue(</span><span class="si">%s</span><span class="s1">), self._SO_class_</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span>
                     <span class="n">column</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">and</span> <span class="nb">repr</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">refColumn</span><span class="p">)))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawGetterName</span><span class="p">(</span><span class="n">origName</span><span class="p">),</span> <span class="n">getter</span><span class="p">)</span>

            <span class="c1"># And we set the _get_columnName version</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">origName</span><span class="p">)):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">origName</span><span class="p">),</span> <span class="n">getter</span><span class="p">)</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainForeignGetters</span><span class="p">[</span><span class="n">origName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">column</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
                <span class="c1"># The setter just gets the ID of the object,</span>
                <span class="c1"># and then sets the real column.</span>
                <span class="n">setter</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                    <span class="s1">&#39;lambda self, val: &#39;</span>
                    <span class="s1">&#39;setattr(self, </span><span class="si">%s</span><span class="s1">, self._SO_getID(val, </span><span class="si">%s</span><span class="s1">))&#39;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">column</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">and</span> <span class="nb">repr</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">refColumn</span><span class="p">)))</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawSetterName</span><span class="p">(</span><span class="n">origName</span><span class="p">),</span> <span class="n">setter</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">origName</span><span class="p">)):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">origName</span><span class="p">),</span> <span class="n">setter</span><span class="p">)</span>
                    <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainForeignSetters</span><span class="p">[</span><span class="n">origName</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">classregistry</span><span class="o">.</span><span class="n">registry</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span><span class="o">.</span><span class="n">addClassCallback</span><span class="p">(</span>
                <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">foreign</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">foreign</span><span class="p">),</span>
                <span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_class_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">alternateMethodName</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                <span class="s1">&#39;lambda cls, val, connection=None: &#39;</span>
                <span class="s1">&#39;cls._SO_fetchAlternateID(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, val, connection=connection)&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">dbName</span><span class="p">)))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">alternateMethodName</span><span class="p">,</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">changeSchema</span><span class="p">:</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span><span class="p">:</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.addColumnsFromDatabase"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.addColumnsFromDatabase">[docs]</a>    <span class="k">def</span> <span class="nf">addColumnsFromDatabase</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">for</span> <span class="n">columnDef</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">columnsFromSchema</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">soClass</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columnDef</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">)</span> <span class="ow">and</span> <span class="n">PY2</span><span class="p">:</span>
                    <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">columnDef</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.delColumn"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.delColumn">[docs]</a>    <span class="k">def</span> <span class="nf">delColumn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">changeSchema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">column</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;ID&#39;</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">column</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="s1">&#39;ID&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown column &#39;</span> <span class="o">+</span> <span class="n">column</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">Col</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="n">c</span><span class="o">.</span><span class="n">columnDef</span><span class="p">:</span>
                    <span class="n">column</span> <span class="o">=</span> <span class="n">c</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s2">&quot;Column with definition </span><span class="si">%r</span><span class="s2"> not found&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="p">)</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">DeleteColumnSignal</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                 <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
        <span class="k">del</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawGetterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainGetters</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawSetterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainSetters</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span>
                    <span class="n">rawGetterName</span><span class="p">(</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span>
                                  <span class="n">instanceIDAttrToAttr</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainForeignGetters</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span>
                    <span class="n">rawSetterName</span><span class="p">(</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span>
                                  <span class="n">instanceIDAttrToAttr</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainForeignSetters</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">alternateMethodName</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">alternateMethodName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">changeSchema</span><span class="p">:</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">delColumn</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span><span class="p">:</span>
            <span class="n">unmakeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span></div>

    <span class="c1">########################################</span>
    <span class="c1"># Join handling</span>
    <span class="c1">########################################</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.addJoin"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.addJoin">[docs]</a>    <span class="k">def</span> <span class="nf">addJoin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">joinDef</span><span class="p">):</span>
        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span>
        <span class="c1"># The name of the method we&#39;ll create.  If it&#39;s</span>
        <span class="c1"># automatically generated, it&#39;s generated by the</span>
        <span class="c1"># join class.</span>
        <span class="n">join</span> <span class="o">=</span> <span class="n">joinDef</span><span class="o">.</span><span class="n">withClass</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="n">join</span><span class="o">.</span><span class="n">joinMethodName</span>

        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">joinDef</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joinDefinitions</span><span class="p">:</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joinDefinitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">joinDef</span><span class="p">)</span>

        <span class="c1"># The function fetches the join by index, and</span>
        <span class="c1"># then lets the join object do the rest of the</span>
        <span class="c1"># work:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
            <span class="s1">&#39;lambda self: self.sqlmeta.joins[</span><span class="si">%i</span><span class="s1">].performJoin(self)&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>

        <span class="c1"># And we do the standard _SO_get_... _get_... deal</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawGetterName</span><span class="p">(</span><span class="n">meth</span><span class="p">),</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">meth</span><span class="p">)):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">meth</span><span class="p">),</span> <span class="n">func</span><span class="p">)</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinGetters</span><span class="p">[</span><span class="n">meth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Some joins allow you to remove objects from the</span>
        <span class="c1"># join.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">):</span>
            <span class="c1"># Again, we let it do the remove, and we do the</span>
            <span class="c1"># standard naming trick.</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                <span class="s1">&#39;lambda self, obj: self.sqlmeta.joins[</span><span class="si">%i</span><span class="s1">].remove(self, obj)&#39;</span> <span class="o">%</span>
                <span class="n">index</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_remove&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinRemovers</span><span class="p">[</span><span class="n">meth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Some joins allow you to add objects.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">):</span>
            <span class="c1"># And again...</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span>
                <span class="s1">&#39;lambda self, obj: self.sqlmeta.joins[</span><span class="si">%i</span><span class="s1">].add(self, obj)&#39;</span> <span class="o">%</span>
                <span class="n">index</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_add&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinAdders</span><span class="p">[</span><span class="n">meth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span><span class="p">:</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.delJoin"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.delJoin">[docs]</a>    <span class="k">def</span> <span class="nf">delJoin</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">joinDef</span><span class="p">):</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
            <span class="c1"># previously deleted joins will be None, so it must</span>
            <span class="c1"># be skipped or it&#39;ll error out on the next line.</span>
            <span class="k">if</span> <span class="n">join</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">joinDef</span> <span class="ow">is</span> <span class="n">join</span><span class="o">.</span><span class="n">joinDef</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="s2">&quot;Join </span><span class="si">%r</span><span class="s2"> not found in class </span><span class="si">%r</span><span class="s2"> (from </span><span class="si">%r</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">joinDef</span><span class="p">,</span> <span class="n">soClass</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">))</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="n">join</span><span class="o">.</span><span class="n">joinMethodName</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joinDefinitions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">joinDef</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="n">join</span><span class="p">:</span>
                <span class="c1"># Have to leave None, because we refer to joins</span>
                <span class="c1"># by index.</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">rawGetterName</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinGetters</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">):</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_remove&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemovePrefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinRemovers</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemovePrefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">):</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;_SO_add&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemovePrefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainJoinAdders</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span> <span class="o">+</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemovePrefix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span><span class="p">:</span>
            <span class="n">unmakeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span></div>

    <span class="c1">########################################</span>
    <span class="c1"># Indexes</span>
    <span class="c1">########################################</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.addIndex"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.addIndex">[docs]</a>    <span class="k">def</span> <span class="nf">addIndex</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">indexDef</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">indexDefinitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indexDef</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indexDef</span><span class="o">.</span><span class="n">withClass</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">soClass</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>

    <span class="c1">########################################</span>
    <span class="c1"># Utility methods</span>
    <span class="c1">########################################</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.getColumns"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.getColumns">[docs]</a>    <span class="k">def</span> <span class="nf">getColumns</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="sqlmeta.asDict"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.asDict">[docs]</a>    <span class="k">def</span> <span class="nf">asDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the object as a dictionary of columns to values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getColumns</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="sqlmeta.expireAll"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.sqlmeta.expireAll">[docs]</a>    <span class="k">def</span> <span class="nf">expireAll</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expire all instances of this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">soClass</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">cache_set</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cache</span>
        <span class="n">cache_set</span><span class="o">.</span><span class="n">weakrefAll</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cache_set</span><span class="o">.</span><span class="n">getAll</span><span class="p">(</span><span class="n">soClass</span><span class="p">):</span>
            <span class="n">item</span><span class="o">.</span><span class="n">expire</span><span class="p">()</span></div></div>


<span class="n">sqlhub</span> <span class="o">=</span> <span class="n">dbconnection</span><span class="o">.</span><span class="n">ConnectionHub</span><span class="p">()</span>


<span class="c1"># Turning it on gives earlier warning about things</span>
<span class="c1"># that will be deprecated (having this off we won&#39;t flood people</span>
<span class="c1"># with warnings right away).</span>
<span class="n">warnings_level</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">exception_level</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Current levels:</span>
<span class="c1">#  1) Actively deprecated</span>
<span class="c1">#  2) Deprecated after 1</span>
<span class="c1">#  3) Deprecated after 2</span>


<span class="k">def</span> <span class="nf">deprecated</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">exception_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exception_level</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">warnings_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">warnings_level</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">)</span>

<span class="c1"># if sys.version_info[:2] &lt; (2, 6):</span>
<span class="c1">#     deprecated(&quot;Support for Python 2.5 has been declared obsolete &quot;</span>
<span class="c1">#     &quot;and will be removed in the next release of SQLObject&quot;)</span>


<span class="k">def</span> <span class="nf">setDeprecationLevel</span><span class="p">(</span><span class="n">warning</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the deprecation level for SQLObject.  Low levels are more</span>
<span class="sd">    actively being deprecated.  Any warning at a level at or below</span>
<span class="sd">    ``warning`` will give a warning.  Any warning at a level at or</span>
<span class="sd">    below ``exception`` will give an exception.  You can use a higher</span>
<span class="sd">    ``exception`` level for tests to help upgrade your code.  ``None``</span>
<span class="sd">    for either value means never warn or raise exceptions.</span>

<span class="sd">    The levels currently mean:</span>

<span class="sd">      1) Deprecated in current version.  Will be removed in next version.</span>

<span class="sd">      2) Planned to deprecate in next version, remove later.</span>

<span class="sd">      3) Planned to deprecate sometime, remove sometime much later.</span>

<span class="sd">    As the SQLObject versions progress, the deprecation level of</span>
<span class="sd">    specific features will go down, indicating the advancing nature of</span>
<span class="sd">    the feature&#39;s doom.  We&#39;ll try to keep features at 1 for a major</span>
<span class="sd">    revision.</span>

<span class="sd">    As time continues there may be a level 0, which will give a useful</span>
<span class="sd">    error message (better than ``AttributeError``) but where the</span>
<span class="sd">    feature has been fully removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">warnings_level</span><span class="p">,</span> <span class="n">exception_level</span>
    <span class="n">warnings_level</span> <span class="o">=</span> <span class="n">warning</span>
    <span class="n">exception_level</span> <span class="o">=</span> <span class="n">exception</span>


<span class="k">class</span> <span class="nc">_sqlmeta_attr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">deprecation_level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_level</span> <span class="o">=</span> <span class="n">deprecation_level</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">deprecated</span><span class="p">(</span>
                <span class="s1">&#39;Use of this attribute should be replaced with &#39;</span>
                <span class="s1">&#39;.sqlmeta.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deprecation_level</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">((</span><span class="nb">type</span> <span class="ow">or</span> <span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="n">_postponed_local</span> <span class="o">=</span> <span class="n">local</span><span class="p">()</span>


<span class="c1"># SQLObject is the superclass for all SQLObject classes, of</span>
<span class="c1"># course.  All the deeper magic is done in MetaSQLObject, and</span>
<span class="c1"># only lesser magic is done here.  All the actual work is done</span>
<span class="c1"># here, though -- just automatic method generation (like</span>
<span class="c1"># methods and properties for each column) is done in</span>
<span class="c1"># MetaSQLObject.</span>


<div class="viewcode-block" id="SQLObject"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject">[docs]</a><span class="k">class</span> <span class="nc">SQLObject</span><span class="p">(</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">declarative</span><span class="o">.</span><span class="n">DeclarativeMeta</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>

    <span class="n">_connection</span> <span class="o">=</span> <span class="n">sqlhub</span>

    <span class="n">sqlmeta</span> <span class="o">=</span> <span class="n">sqlmeta</span>

    <span class="c1"># DSM: The _inheritable attribute controls wheter the class can by</span>
    <span class="c1"># DSM: inherited &#39;logically&#39; with a foreignKey and a back reference.</span>
    <span class="n">_inheritable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Is this class inheritable?</span>
    <span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># A reference to the parent instance</span>
    <span class="n">childName</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Children name (to be able to get a subclass)</span>

    <span class="c1"># The law of Demeter: the class should not call another classes by name</span>
    <span class="n">SelectResultsClass</span> <span class="o">=</span> <span class="n">SelectResults</span>

    <span class="k">def</span> <span class="nf">__classinit__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">):</span>

        <span class="c1"># This is true if we&#39;re initializing the SQLObject class,</span>
        <span class="c1"># instead of a subclass:</span>
        <span class="n">is_base</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">==</span> <span class="p">(</span><span class="nb">object</span><span class="p">,)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_SO_setupSqlmeta</span><span class="p">(</span><span class="n">new_attrs</span><span class="p">,</span> <span class="n">is_base</span><span class="p">)</span>

        <span class="n">implicitColumns</span> <span class="o">=</span> <span class="n">_collectAttributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">Col</span><span class="p">)</span>
        <span class="n">implicitJoins</span> <span class="o">=</span> <span class="n">_collectAttributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span> <span class="n">joins</span><span class="o">.</span><span class="n">Join</span><span class="p">)</span>
        <span class="n">implicitIndexes</span> <span class="o">=</span> <span class="n">_collectAttributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span>
                                             <span class="n">index</span><span class="o">.</span><span class="n">DatabaseIndex</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_base</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_SO_cleanDeprecatedAttrs</span><span class="p">(</span><span class="n">new_attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;_connection&#39;</span> <span class="ow">in</span> <span class="n">new_attrs</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;_connection&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
            <span class="k">assert</span> <span class="s1">&#39;connection&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_attrs</span>
        <span class="k">elif</span> <span class="s1">&#39;connection&#39;</span> <span class="ow">in</span> <span class="n">new_attrs</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">new_attrs</span><span class="p">[</span><span class="s1">&#39;connection&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">connection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">######################################################</span>
        <span class="c1"># Set some attributes to their defaults, if necessary.</span>
        <span class="c1"># First we get the connection:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_connection&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">]</span>
            <span class="c1"># See if there&#39;s a __connection__ global in</span>
            <span class="c1"># the module, use it if there is.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s1">&#39;__connection__&#39;</span><span class="p">):</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">__connection__</span>

        <span class="c1"># Do not check hasattr(cls, &#39;_connection&#39;) here - it is possible</span>
        <span class="c1"># SQLObject parent class has a connection attribute that came</span>
        <span class="c1"># from sqlhub, e.g.; check __dict__ only.</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;_connection&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">setConnection</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span>

        <span class="c1"># We have to check if there are columns in the inherited</span>
        <span class="c1"># _columns where the attribute has been set to None in this</span>
        <span class="c1"># class.  If so, then we need to remove that column from</span>
        <span class="c1"># _columns.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">new_attrs</span> <span class="ow">and</span> <span class="n">new_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">implicitColumns</span><span class="p">:</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

        <span class="c1"># Now the class is in an essentially OK-state, so we can</span>
        <span class="c1"># set up any magic attributes:</span>
        <span class="n">declarative</span><span class="o">.</span><span class="n">setup_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">fromDatabase</span><span class="p">:</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumnsFromDatabase</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">implicitJoins</span><span class="p">:</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addJoin</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">implicitIndexes</span><span class="p">:</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">order_getter</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">creationOrder</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">order_getter</span><span class="p">)</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">order_getter</span><span class="p">)</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">indexDefinitions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">order_getter</span><span class="p">)</span>
        <span class="c1"># Joins cannot be sorted because addJoin created accessors</span>
        <span class="c1"># that remember indexes.</span>
        <span class="c1"># sqlmeta.joins.sort(key=order_getter)</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joinDefinitions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">order_getter</span><span class="p">)</span>

        <span class="c1"># We don&#39;t setup the properties until we&#39;re finished with the</span>
        <span class="c1"># batch adding of all the columns...</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_notifyFinishClassCreation</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_SO_finishedClassCreation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">makeProperties</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># We use the magic &quot;q&quot; attribute for accessing lazy</span>
        <span class="c1"># SQL where-clause generation.  See the sql module for</span>
        <span class="c1"># more.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_base</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectTable</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectTableWithJoins</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">classregistry</span><span class="o">.</span><span class="n">registry</span><span class="p">(</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span><span class="o">.</span><span class="n">addClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_SO_setupSqlmeta</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span> <span class="n">is_base</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This fixes up the sqlmeta attribute.  It handles both the case</span>
<span class="sd">        where no sqlmeta was given (in which we need to create another</span>
<span class="sd">        subclass), or the sqlmeta given doesn&#39;t have the proper</span>
<span class="sd">        inheritance.  Lastly it calls sqlmeta.setClass, which handles</span>
<span class="sd">        much of the setup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;sqlmeta&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_attrs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_base</span><span class="p">):</span>
            <span class="c1"># We have to create our own subclass, usually.</span>
            <span class="c1"># type(className, bases_tuple, attr_dict) creates a new subclass.</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;sqlmeta&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,),</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="p">):</span>
            <span class="c1"># We allow no superclass and an object superclass, instead</span>
            <span class="c1"># of inheriting from sqlmeta; but in that case we replace</span>
            <span class="c1"># the class and just move over its attributes:</span>
            <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="vm">__bases__</span> <span class="ow">in</span> <span class="p">((),</span> <span class="p">(</span><span class="nb">object</span><span class="p">,)),</span> <span class="p">(</span>
                <span class="s2">&quot;If you do not inherit your sqlmeta class from &quot;</span>
                <span class="s2">&quot;sqlobject.sqlmeta, it must not inherit from any other &quot;</span>
                <span class="s2">&quot;class (your sqlmeta inherits from: </span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                <span class="n">superclass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;sqlmeta&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">superclass</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;No sqlmeta class could be found in any superclass &quot;</span>
                    <span class="s2">&quot;(while fixing up sqlmeta </span><span class="si">%r</span><span class="s2"> inheritance)&quot;</span>
                    <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">):</span>
                    <span class="c1"># Magic values shouldn&#39;t be passed through:</span>
                    <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;sqlmeta&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">superclass</span><span class="p">,),</span> <span class="n">values</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_base</span><span class="p">:</span>  <span class="c1"># Do not pollute the base sqlmeta class</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">setClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_SO_cleanDeprecatedAttrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This removes attributes on SQLObject subclasses that have</span>
<span class="sd">        been deprecated; they are moved to the sqlmeta class, and</span>
<span class="sd">        a deprecation warning is given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">():</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">new_attrs</span><span class="p">:</span>
                <span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> is deprecated and read-only; please do &quot;</span>
                           <span class="s2">&quot;not use it in your classes until it is fully &quot;</span>
                           <span class="s2">&quot;deprecated&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.get"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selectResults</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;None is not a possible id for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cache</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cache</span>

        <span class="c1"># This whole sequence comes from Cache.CacheFactory&#39;s</span>
        <span class="c1"># behavior, where a None returned means a cache miss.</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">_SO_fetch_no_create</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">val</span><span class="o">.</span><span class="n">_SO_validatorState</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectState</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">val</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">selectResults</span><span class="p">)</span>
                <span class="n">cache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">cache</span><span class="o">.</span><span class="n">finishPut</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">selectResults</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="n">val</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span><span class="o">.</span><span class="n">_SO_selectInit</span><span class="p">(</span><span class="n">selectResults</span><span class="p">)</span>
                <span class="n">val</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">val</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">val</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_notifyFinishClassCreation</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selectResults</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># This function gets called only when the object is</span>
        <span class="c1"># created, unlike __init__ which would be called</span>
        <span class="c1"># anytime the object was returned from cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="c1"># If no connection was given, we&#39;ll inherit the class</span>
        <span class="c1"># instance variable which should have a _connection</span>
        <span class="c1"># attribute.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_connection&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">connection</span>
            <span class="c1"># Sometimes we need to know if this instance is</span>
            <span class="c1"># global or tied to a particular connection.</span>
            <span class="c1"># This flag tells us that:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_perConnection</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectResults</span><span class="p">:</span>
            <span class="n">dbNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">dbName</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">]</span>
            <span class="n">selectResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_selectOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbNames</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectResults</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SQLObjectNotFound</span><span class="p">(</span>
                    <span class="s2">&quot;The object </span><span class="si">%s</span><span class="s2"> by the ID </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_selectInit</span><span class="p">(</span><span class="n">selectResults</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_SO_loadValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrName</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrName</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Maybe, just in the moment since we got the lock,</span>
                    <span class="c1"># some other thread did a _SO_loadValue and we</span>
                    <span class="c1"># have the attribute!  Let&#39;s try and find out!  We</span>
                    <span class="c1"># can keep trying this all day and still beat the</span>
                    <span class="c1"># performance on the database call (okay, we can</span>
                    <span class="c1"># keep trying this for a few msecs at least)...</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrName</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">dbNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">dbName</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">]</span>
                <span class="n">selectResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_selectOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbNames</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">selectResults</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SQLObjectNotFound</span><span class="p">(</span>
                        <span class="s2">&quot;The object </span><span class="si">%s</span><span class="s2"> by the ID </span><span class="si">%s</span><span class="s2"> has been deleted&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_SO_selectInit</span><span class="p">(</span><span class="n">selectResults</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrName</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<div class="viewcode-block" id="SQLObject.sync"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.sync">[docs]</a>    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">lazyUpdate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syncUpdate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dbNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">dbName</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">]</span>
            <span class="n">selectResults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_selectOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbNames</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectResults</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SQLObjectNotFound</span><span class="p">(</span>
                    <span class="s2">&quot;The object </span><span class="si">%s</span><span class="s2"> by the ID </span><span class="si">%s</span><span class="s2"> has been deleted&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_selectInit</span><span class="p">(</span><span class="n">selectResults</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="SQLObject.syncUpdate"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.syncUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">syncUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">columns</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                              <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">columns</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">creationOrder</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdatedSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLObject.expire"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.expire">[docs]</a>    <span class="k">def</span> <span class="nf">expire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">expired</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_SO_setValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">from_python</span><span class="p">,</span> <span class="n">to_python</span><span class="p">):</span>
        <span class="c1"># This is the place where we actually update the</span>
        <span class="c1"># database.</span>

        <span class="c1"># If we are _creating, the object doesn&#39;t yet exist</span>
        <span class="c1"># in the database, and we can&#39;t insert it until all</span>
        <span class="c1"># the parts are set.  So we just keep them in a</span>
        <span class="c1"># dictionary until later:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="s2">&quot;row_update_sig_suppress&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdateSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="c1"># Already called RowUpdateSignal, don&#39;t call it again</span>
            <span class="c1"># inside .set()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">row_update_sig_suppress</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">row_update_sig_suppress</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">from_python</span><span class="p">:</span>
            <span class="n">dbValue</span> <span class="o">=</span> <span class="n">from_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dbValue</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">to_python</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">to_python</span><span class="p">(</span><span class="n">dbValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">lazyUpdate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbValue</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_update</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
                    <span class="n">dbValue</span><span class="p">)])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">cacheValues</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdatedSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="SQLObject.set"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_suppress_set_sig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="s2">&quot;row_update_sig_suppress&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">_suppress_set_sig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdateSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="c1"># set() is used to update multiple values at once,</span>
        <span class="c1"># potentially with one SQL statement if possible.</span>

        <span class="c1"># Filter out items that don&#39;t map to column names.</span>
        <span class="c1"># Those will be set directly on the object using</span>
        <span class="c1"># setattr(obj, name, value).</span>
        <span class="k">def</span> <span class="nf">is_column</span><span class="p">(</span><span class="n">_c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_plainSetters</span>

        <span class="k">def</span> <span class="nf">f_is_column</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">is_column</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">f_not_column</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">is_column</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">f_not_column</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">f_is_column</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>

        <span class="c1"># _creating is special, see _SO_setValue</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">lazyUpdate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">from_python</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_SO_from_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">from_python</span><span class="p">:</span>
                    <span class="n">kw</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbValue</span> <span class="o">=</span> <span class="n">from_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dbValue</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">to_python</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_SO_to_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">to_python</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">to_python</span><span class="p">(</span><span class="n">dbValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.set() got an unexpected keyword argument &quot;</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (with attribute </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># We have to go through and see if the setters are</span>
            <span class="c1"># &quot;plain&quot;, that is, if the user has changed their</span>
            <span class="c1"># definition in any way (put in something that</span>
            <span class="c1"># normalizes the value or checks for consistency,</span>
            <span class="c1"># for instance).  If so then we have to use plain</span>
            <span class="c1"># old setattr() to change the value, since we can&#39;t</span>
            <span class="c1"># read the user&#39;s mind.  We&#39;ll combine everything</span>
            <span class="c1"># else into a single UPDATE, if necessary.</span>
            <span class="n">toUpdate</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">from_python</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_SO_from_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">from_python</span><span class="p">:</span>
                    <span class="n">dbValue</span> <span class="o">=</span> <span class="n">from_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dbValue</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">to_python</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_SO_to_python_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">to_python</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">to_python</span><span class="p">(</span><span class="n">dbValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">cacheValues</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">toUpdate</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbValue</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.set() got an unexpected keyword argument &quot;</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (with attribute </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">toUpdate</span><span class="p">:</span>
                <span class="n">toUpdate</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="n">toUpdate</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">creationOrder</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">toUpdate</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdatedSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_SO_selectInit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_col</span><span class="p">,</span> <span class="n">colValue</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_col</span><span class="o">.</span><span class="n">to_python</span><span class="p">:</span>
                <span class="n">colValue</span> <span class="o">=</span> <span class="n">_col</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">colValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceName</span><span class="p">(</span><span class="n">_col</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">colValue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_SO_getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># Retrieves a single value from the database.  Simple.</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_obsolete</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> with id </span><span class="si">%s</span><span class="s2"> has become obsolete&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="c1"># @@: do we really need this lock?</span>
        <span class="c1"># self._SO_writeLock.acquire()</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_selectOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">dbName</span><span class="p">])</span>
        <span class="c1"># self._SO_writeLock.release()</span>
        <span class="k">assert</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> with id </span><span class="si">%s</span><span class="s2"> is not in the database&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">to_python</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_SO_foreignKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">joinClass</span><span class="p">,</span> <span class="n">idName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_perConnection</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">idName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Get by id</span>
            <span class="k">return</span> <span class="n">joinClass</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">joinClass</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">joinClass</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">idName</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span>
            <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span><span class="o">.</span><span class="n">getOne</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># If we are the outmost constructor of a hiearchy of</span>
        <span class="c1"># InheritableSQLObjects (or simlpy _the_ constructor of a &quot;normal&quot;</span>
        <span class="c1"># SQLObject), we create a threadlocal list that collects the</span>
        <span class="c1"># RowCreatedSignals, and executes them if this very constructor is left</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_postponed_local</span><span class="o">.</span><span class="n">postponed_calls</span>
            <span class="n">postponed_created</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">_postponed_local</span><span class="o">.</span><span class="n">postponed_calls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">postponed_created</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># We shadow the sqlmeta class with an instance of sqlmeta</span>
            <span class="c1"># that points to us (our sqlmeta buddy object; where the</span>
            <span class="c1"># sqlmeta class is our class&#39;s buddy class)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># The get() classmethod/constructor uses a magic keyword</span>
            <span class="c1"># argument when it wants an empty object, fetched from the</span>
            <span class="c1"># database.  So we have nothing more to do in that case:</span>
            <span class="k">if</span> <span class="s1">&#39;_SO_fetch_no_create&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowCreateSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>

            <span class="c1"># Pass the connection object along if we were given one.</span>
            <span class="k">if</span> <span class="s1">&#39;connection&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_connection&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">connection</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">connection</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_perConnection</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

            <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># if we are the creator of the tl-storage, we</span>
            <span class="c1"># have to exectute and under all circumstances</span>
            <span class="c1"># remove the tl-storage</span>
            <span class="k">if</span> <span class="n">postponed_created</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">_postponed_local</span><span class="o">.</span><span class="n">postponed_calls</span><span class="p">:</span>
                        <span class="n">func</span><span class="p">()</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">_postponed_local</span><span class="o">.</span><span class="n">postponed_calls</span>

    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># First we do a little fix-up on the keywords we were</span>
        <span class="c1"># passed:</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>

            <span class="c1"># Then we check if the column wasn&#39;t passed in, and</span>
            <span class="c1"># if not we try to get the default.</span>
            <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">and</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">default</span>

                <span class="c1"># If we don&#39;t get it, it&#39;s an error:</span>
                <span class="c1"># If we specified an SQL DEFAULT, then we should use that</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">NoDefault</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">defaultSQL</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">() did not get expected keyword argument &quot;</span>
                            <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># There is defaultSQL for the column -</span>
                        <span class="c1"># do not put the column to kw</span>
                        <span class="c1"># so that the backend creates the value.</span>
                        <span class="k">continue</span>

                <span class="c1"># Otherwise we put it in as though they did pass</span>
                <span class="c1"># that keyword:</span>

                <span class="n">kw</span><span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c1"># Then we finalize the process:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_finishCreate</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_SO_finishCreate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Here&#39;s where an INSERT is finalized.</span>
        <span class="c1"># These are all the column values that were supposed</span>
        <span class="c1"># to be set, but were delayed until now:</span>
        <span class="n">setters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">setters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">setters</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">creationOrder</span><span class="p">)</span>
        <span class="c1"># Here&#39;s their database names:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">dbName</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">setters</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">setters</span><span class="p">]</span>
        <span class="c1"># Get rid of _SO_create*, we aren&#39;t creating anymore.</span>
        <span class="c1"># Doesn&#39;t have to be threadsafe because we&#39;re still in</span>
        <span class="c1"># new(), which doesn&#39;t need to be threadsafe.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">lazyUpdate</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span>

        <span class="c1"># Do the insert -- most of the SQL in this case is left</span>
        <span class="c1"># up to DBConnection, since getting a new ID is</span>
        <span class="c1"># non-standard.</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">queryInsertID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="nb">id</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cache</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">_send_RowCreatedSignal</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowCreatedSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">_postponed_local</span><span class="o">.</span><span class="n">postponed_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_send_RowCreatedSignal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_SO_getID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">refColumn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">getID</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">refColumn</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_findAlternateID</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dbName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;column&#39; and &#39;value&#39; tuples must be of the same size&quot;</span><span class="p">)</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">from_python</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_SO_from_python_&#39;</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">from_python</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">from_python</span><span class="p">(</span>
                    <span class="n">v</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectState</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">))</span>
            <span class="n">new_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">AND</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">_n</span><span class="p">)</span> <span class="o">==</span> <span class="n">_v</span> <span class="k">for</span> <span class="n">_n</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span><span class="p">)</span><span class="o">.</span><span class="n">_SO_selectOneAlt</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span><span class="p">]</span> <span class="o">+</span>
            <span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">dbName</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">],</span>
            <span class="n">condition</span><span class="p">),</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_SO_fetchAlternateID</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dbName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">idxName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_findAlternateID</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dbName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idxName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SQLObjectNotFound</span><span class="p">(</span>
                    <span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> by alternateID </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)):</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="n">names</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SQLObjectNotFound</span><span class="p">(</span>
                    <span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> by unique index </span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">) does not exist&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">idxName</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
                          <span class="n">selectResults</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">selectResults</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_SO_depends</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">findDependencies</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.select"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clauseTables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">orderBy</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">lazyColumns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">distinct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">join</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">forUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SelectResultsClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clause</span><span class="p">,</span>
                                      <span class="n">clauseTables</span><span class="o">=</span><span class="n">clauseTables</span><span class="p">,</span>
                                      <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                                      <span class="n">lazyColumns</span><span class="o">=</span><span class="n">lazyColumns</span><span class="p">,</span>
                                      <span class="nb">reversed</span><span class="o">=</span><span class="nb">reversed</span><span class="p">,</span>
                                      <span class="n">distinct</span><span class="o">=</span><span class="n">distinct</span><span class="p">,</span>
                                      <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
                                      <span class="n">join</span><span class="o">=</span><span class="n">join</span><span class="p">,</span> <span class="n">forUpdate</span><span class="o">=</span><span class="n">forUpdate</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.selectBy"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.selectBy">[docs]</a>    <span class="k">def</span> <span class="nf">selectBy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SelectResultsClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                                      <span class="n">conn</span><span class="o">.</span><span class="n">_SO_columnClause</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">kw</span><span class="p">),</span>
                                      <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.tableExists"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.tableExists">[docs]</a>    <span class="k">def</span> <span class="nf">tableExists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.dropTable"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.dropTable">[docs]</a>    <span class="k">def</span> <span class="nf">dropTable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ifExists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropJoinTables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">if</span> <span class="n">ifExists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">extra_sql</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">DropTableSignal</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                         <span class="n">extra_sql</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">dropTable</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">cascade</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dropJoinTables</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">dropJoinTables</span><span class="p">(</span><span class="n">ifExists</span><span class="o">=</span><span class="n">ifExists</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">extra_sql</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createTable"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createTable">[docs]</a>    <span class="k">def</span> <span class="nf">createTable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ifNotExists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">createJoinTables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">createIndexes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">applyConstraints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">if</span> <span class="n">ifNotExists</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">extra_sql</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">CreateTableSignal</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                         <span class="n">extra_sql</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">applyConstraints</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extra_sql</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createJoinTables</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">createJoinTables</span><span class="p">(</span><span class="n">ifNotExists</span><span class="o">=</span><span class="n">ifNotExists</span><span class="p">,</span>
                                 <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createIndexes</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">createIndexes</span><span class="p">(</span><span class="n">ifNotExists</span><span class="o">=</span><span class="n">ifNotExists</span><span class="p">,</span>
                              <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">extra_sql</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createTableSQL"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createTableSQL">[docs]</a>    <span class="k">def</span> <span class="nf">createTableSQL</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">createJoinTables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">createIndexes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">constraints</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">createTableSQL</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createJoinTables</span><span class="p">:</span>
            <span class="n">join_sql</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">createJoinTablesSQL</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">join_sql</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">+=</span> <span class="s1">&#39;;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">join_sql</span>
        <span class="k">if</span> <span class="n">createIndexes</span><span class="p">:</span>
            <span class="n">index_sql</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">createIndexesSQL</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index_sql</span><span class="p">:</span>
                <span class="n">sql</span> <span class="o">+=</span> <span class="s1">&#39;;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">index_sql</span>
        <span class="k">return</span> <span class="n">sql</span><span class="p">,</span> <span class="n">constraints</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createJoinTables"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createJoinTables">[docs]</a>    <span class="k">def</span> <span class="nf">createJoinTables</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ifNotExists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_getJoinsToCreate</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ifNotExists</span> <span class="ow">and</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="n">join</span><span class="o">.</span><span class="n">intermediateTable</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">_SO_createJoinTable</span><span class="p">(</span><span class="n">join</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createJoinTablesSQL"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createJoinTablesSQL">[docs]</a>    <span class="k">def</span> <span class="nf">createJoinTablesSQL</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_getJoinsToCreate</span><span class="p">():</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">_SO_createJoinTableSQL</span><span class="p">(</span><span class="n">join</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createIndexes"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createIndexes">[docs]</a>    <span class="k">def</span> <span class="nf">createIndexes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ifNotExists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">for</span> <span class="n">_index</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_index</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">_SO_createIndex</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_index</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.createIndexesSQL"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.createIndexesSQL">[docs]</a>    <span class="k">def</span> <span class="nf">createIndexesSQL</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_index</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_index</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">createIndexSQL</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_index</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_getJoinsToCreate</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">joins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">join</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">join</span><span class="o">.</span><span class="n">hasIntermediateTable</span><span class="p">()</span> <span class="ow">or</span> \
                    <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;createRelatedTable&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">join</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">&gt;</span> <span class="n">join</span><span class="o">.</span><span class="n">otherClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">joins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">joins</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.dropJoinTables"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.dropJoinTables">[docs]</a>    <span class="k">def</span> <span class="nf">dropJoinTables</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ifExists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">join</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">join</span><span class="o">.</span><span class="n">hasIntermediateTable</span><span class="p">()</span> <span class="ow">or</span> \
                    <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;createRelatedTable&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">join</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">&gt;</span> <span class="n">join</span><span class="o">.</span><span class="n">otherClass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">ifExists</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="n">conn</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="n">join</span><span class="o">.</span><span class="n">intermediateTable</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">_SO_dropJoinTable</span><span class="p">(</span><span class="n">join</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.clearTable"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.clearTable">[docs]</a>    <span class="k">def</span> <span class="nf">clearTable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clearJoinTables</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># 3-03 @@: Maybe this should check the cache... but it&#39;s</span>
        <span class="c1"># kind of crude anyway, so...</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">clearTable</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clearJoinTables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_getJoinsToCreate</span><span class="p">():</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">clearTable</span><span class="p">(</span><span class="n">join</span><span class="o">.</span><span class="n">intermediateTable</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLObject.destroySelf"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.destroySelf">[docs]</a>    <span class="k">def</span> <span class="nf">destroySelf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowDestroySignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="c1"># Kills this object.  Kills it dead!</span>

        <span class="n">klass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="c1"># Free related joins on the base class</span>
        <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="n">joins</span><span class="o">.</span><span class="n">SORelatedJoin</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM </span><span class="si">%s</span><span class="s2"> WHERE </span><span class="si">%s</span><span class="s2">=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">join</span><span class="o">.</span><span class="n">intermediateTable</span><span class="p">,</span>
                                                    <span class="n">join</span><span class="o">.</span><span class="n">joinColumn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

        <span class="n">depends</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">depends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_depends</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">depends</span><span class="p">:</span>
            <span class="c1"># Free related joins</span>
            <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">k</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="n">joins</span><span class="o">.</span><span class="n">SORelatedJoin</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="n">join</span><span class="o">.</span><span class="n">otherClassName</span> <span class="o">==</span> <span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM </span><span class="si">%s</span><span class="s2"> WHERE </span><span class="si">%s</span><span class="s2">=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">join</span><span class="o">.</span><span class="n">intermediateTable</span><span class="p">,</span>
                                                        <span class="n">join</span><span class="o">.</span><span class="n">otherColumn</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

            <span class="n">cols</span> <span class="o">=</span> <span class="n">findDependantColumns</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

            <span class="c1"># Don&#39;t confuse the rest of the process</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">query</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">delete</span> <span class="o">=</span> <span class="n">setnull</span> <span class="o">=</span> <span class="n">restrict</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">_col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_col</span><span class="o">.</span><span class="n">cascade</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># Found a restriction</span>
                    <span class="n">restrict</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">query</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">_col</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_col</span><span class="o">.</span><span class="n">cascade</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
                    <span class="n">setnull</span> <span class="o">=</span> <span class="n">_col</span><span class="o">.</span><span class="n">name</span>
                <span class="k">elif</span> <span class="n">_col</span><span class="o">.</span><span class="n">cascade</span><span class="p">:</span>
                    <span class="n">delete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">assert</span> <span class="n">delete</span> <span class="ow">or</span> <span class="n">setnull</span> <span class="ow">or</span> <span class="n">restrict</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;Class </span><span class="si">%s</span><span class="s2"> depends on </span><span class="si">%s</span><span class="s2"> accoriding to &quot;</span>
                <span class="s2">&quot;findDependantColumns, but this seems inaccurate&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">klass</span><span class="p">))</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">OR</span><span class="p">(</span><span class="o">*</span><span class="n">query</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">restrict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="c1"># Restrictions only apply if there are</span>
                    <span class="c1"># matching records on the related table</span>
                    <span class="k">raise</span> <span class="n">SQLObjectIntegrityError</span><span class="p">(</span>
                        <span class="s2">&quot;Tried to delete </span><span class="si">%s</span><span class="s2">::</span><span class="si">%s</span><span class="s2"> but &quot;</span>
                        <span class="s2">&quot;table </span><span class="si">%s</span><span class="s2"> has a restriction against it&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">destroySelf</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">setnull</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_obsolete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">_SO_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">post_funcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowDestroyedSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">post_funcs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_funcs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.delete"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">destroySelf</span><span class="p">()</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.deleteMany"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.deleteMany">[docs]</a>    <span class="k">def</span> <span class="nf">deleteMany</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">where</span><span class="p">)))</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.deleteBy"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.deleteBy">[docs]</a>    <span class="k">def</span> <span class="nf">deleteBy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">_SO_columnClause</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">kw</span><span class="p">))))</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
            <span class="c1"># Object initialization not finished.  No attributes can be read.</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> (not initialized)&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                  <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                      <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                       <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reprItems</span><span class="p">()]))</span>

    <span class="k">def</span> <span class="nf">__sqlrepr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.sqlrepr"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.sqlrepr">[docs]</a>    <span class="k">def</span> <span class="nf">sqlrepr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span><span class="p">)</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.coerceID"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.coerceID">[docs]</a>    <span class="k">def</span> <span class="nf">coerceID</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_reprItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_col</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="mi">17</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">_col</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SQLObject.setConnection"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.setConnection">[docs]</a>    <span class="k">def</span> <span class="nf">setConnection</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">dbconnection</span><span class="o">.</span><span class="n">connectionForURI</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SQLObject.tablesUsedImmediate"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.SQLObject.tablesUsedImmediate">[docs]</a>    <span class="k">def</span> <span class="nf">tablesUsedImmediate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">q</span><span class="p">]</span></div>

    <span class="c1"># hash implementation</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We hash on class name and id, since that should be</span>
        <span class="c1"># unique</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

    <span class="c1"># Comparison</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="c1"># (De)serialization (pickle, etc.)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_perConnection</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pickle</span> <span class="k">import</span> <span class="n">PicklingError</span>
            <span class="k">raise</span> <span class="n">PicklingError</span><span class="p">(</span>
                <span class="s1">&#39;Cannot pickle an SQLObject instance &#39;</span>
                <span class="s1">&#39;that has a per-instance connection&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">lazyUpdate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syncUpdate</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;sqlmeta&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_SO_validatorState&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_SO_writeLock&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;_SO_createValues&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">_SO_fetch_no_create</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_validatorState</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLObjectState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_writeLock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SO_createValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">cache</span>
        <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">tryGet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot unpickle </span><span class="si">%s</span><span class="s2"> row with id=</span><span class="si">%s</span><span class="s2"> - &quot;</span>
                <span class="s2">&quot;a different instance with the id already exists &quot;</span>
                <span class="s2">&quot;in the cache&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">setterName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;_set_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">rawSetterName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;_SO_set_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">getterName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;_get_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">rawGetterName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;_SO_get_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">instanceName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;_SO_val_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="c1">########################################</span>
<span class="c1"># Utility functions (for external consumption)</span>
<span class="c1">########################################</span>

<div class="viewcode-block" id="getID"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.getID">[docs]</a><span class="k">def</span> <span class="nf">getID</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">refColumn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SQLObject</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">refColumn</span> <span class="ow">or</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">long</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="getObject"><a class="viewcode-back" href="../../api/sqlobject.main.html#sqlobject.include.tests.test_hashcol.getObject">[docs]</a><span class="k">def</span> <span class="nf">getObject</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">long</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">klass</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;NoDefault&#39;</span><span class="p">,</span> <span class="s1">&#39;SQLObject&#39;</span><span class="p">,</span> <span class="s1">&#39;SQLObjectIntegrityError&#39;</span><span class="p">,</span> <span class="s1">&#39;SQLObjectNotFound&#39;</span><span class="p">,</span>
    <span class="s1">&#39;getID&#39;</span><span class="p">,</span> <span class="s1">&#39;getObject&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlhub&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlmeta&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.2.0a1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2017, Ian Bicking and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>