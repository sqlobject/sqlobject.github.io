

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sqlobject.col &#8212; SQLObject 3.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sqlobject.col</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Col -- SQLObject columns</span>

<span class="sd">Note that each column object is named BlahBlahCol, and these are used</span>
<span class="sd">in class definitions.  But there&#39;s also a corresponding SOBlahBlahCol</span>
<span class="sd">object, which is used in SQLObject *classes*.</span>

<span class="sd">An explanation: when a SQLObject subclass is created, the metaclass</span>
<span class="sd">looks through your class definition for any subclasses of Col.  It</span>
<span class="sd">collects them together, and indexes them to do all the database stuff</span>
<span class="sd">you like, like the magic attributes and whatnot.  It then asks the Col</span>
<span class="sd">object to create an SOCol object (usually a subclass, actually).  The</span>
<span class="sd">SOCol object contains all the interesting logic, as well as a record</span>
<span class="sd">of the attribute name you used and the class it is bound to (set by</span>
<span class="sd">the metaclass).</span>

<span class="sd">So, in summary: Col objects are what you define, but SOCol objects</span>
<span class="sd">are what gets used.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">array</span> <span class="k">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="k">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">count</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="k">import</span> <span class="n">UUID</span>
<span class="kn">import</span> <span class="nn">weakref</span>

<span class="kn">from</span> <span class="nn">formencode</span> <span class="k">import</span> <span class="n">compound</span><span class="p">,</span> <span class="n">validators</span>
<span class="kn">from</span> <span class="nn">.classregistry</span> <span class="k">import</span> <span class="n">findClass</span>
<span class="c1"># Sadly the name &quot;constraints&quot; conflicts with many of the function</span>
<span class="c1"># arguments in this module, so we rename it:</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">constraints</span> <span class="k">as</span> <span class="n">constrs</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">converters</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sqlbuilder</span>
<span class="kn">from</span> <span class="nn">.styles</span> <span class="k">import</span> <span class="n">capword</span>
<span class="kn">from</span> <span class="nn">.compat</span> <span class="k">import</span> <span class="n">PY2</span><span class="p">,</span> <span class="n">string_type</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">,</span> <span class="n">buffer_type</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">datetime_available</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mx</span> <span class="k">import</span> <span class="n">DateTime</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># old version of mxDateTime,</span>
        <span class="c1"># or Zope&#39;s Version if we&#39;re running with Zope</span>
        <span class="kn">import</span> <span class="nn">DateTime</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">mxdatetime_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mxdatetime_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">mxdatetime_available</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">DATETIME_IMPLEMENTATION</span> <span class="o">=</span> <span class="s2">&quot;datetime&quot;</span>
<span class="n">MXDATETIME_IMPLEMENTATION</span> <span class="o">=</span> <span class="s2">&quot;mxDateTime&quot;</span>

<span class="k">if</span> <span class="n">mxdatetime_available</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">):</span>
        <span class="n">DateTimeType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">TimeType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">Time</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Zope</span>
        <span class="n">DateTimeType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">DateTime</span><span class="p">())</span>
        <span class="n">TimeType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">DateTime</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">DateTime</span><span class="o">.</span><span class="n">DateTime</span><span class="p">()))</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime_available&quot;</span><span class="p">,</span> <span class="s2">&quot;mxdatetime_available&quot;</span><span class="p">,</span>
           <span class="s2">&quot;default_datetime_implementation&quot;</span><span class="p">,</span> <span class="s2">&quot;DATETIME_IMPLEMENTATION&quot;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">mxdatetime_available</span><span class="p">:</span>
    <span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MXDATETIME_IMPLEMENTATION&quot;</span><span class="p">)</span>

<span class="n">default_datetime_implementation</span> <span class="o">=</span> <span class="n">DATETIME_IMPLEMENTATION</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span><span class="p">:</span>
    <span class="c1"># alias for python 3 compatibility</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="c1"># This is to satisfy flake8 under python 3</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="n">NoDefault</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">NoDefault</span>


<div class="viewcode-block" id="use_microseconds"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.use_microseconds">[docs]</a><span class="k">def</span> <span class="nf">use_microseconds</span><span class="p">(</span><span class="n">use</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">use</span><span class="p">:</span>
        <span class="n">SODateTimeCol</span><span class="o">.</span><span class="n">datetimeFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
        <span class="n">SOTimeCol</span><span class="o">.</span><span class="n">timeFormat</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>
        <span class="n">dt_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">converters</span><span class="o">.</span><span class="n">DateTimeConverterMS</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">converters</span><span class="o">.</span><span class="n">TimeConverterMS</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SODateTimeCol</span><span class="o">.</span><span class="n">datetimeFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
        <span class="n">SOTimeCol</span><span class="o">.</span><span class="n">timeFormat</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S&#39;</span>
        <span class="n">dt_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">converters</span><span class="o">.</span><span class="n">DateTimeConverter</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">converters</span><span class="o">.</span><span class="n">TimeConverter</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">dt_type</span><span class="p">,</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">dt_types</span><span class="p">:</span>
        <span class="n">converters</span><span class="o">.</span><span class="n">registerConverter</span><span class="p">(</span><span class="n">dt_type</span><span class="p">,</span> <span class="n">converter</span><span class="p">)</span></div>


<span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;use_microseconds&quot;</span><span class="p">)</span>


<span class="n">creationOrder</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>

<span class="c1">########################################</span>
<span class="c1"># Columns</span>
<span class="c1">########################################</span>

<span class="c1"># Col is essentially a column definition, it doesn&#39;t have much logic to it.</span>


<div class="viewcode-block" id="SOCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol">[docs]</a><span class="k">class</span> <span class="nc">SOCol</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">soClass</span><span class="p">,</span>
                 <span class="n">creationOrder</span><span class="p">,</span>
                 <span class="n">dbName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span>
                 <span class="n">defaultSQL</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">foreignKey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">alternateID</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">alternateMethodName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">notNull</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span>
                 <span class="n">notNone</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span>
                 <span class="n">unique</span><span class="o">=</span><span class="n">NoDefault</span><span class="p">,</span>
                 <span class="n">sqlType</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">columnDef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">validator2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">immutable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">cascade</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">noCache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">forceDBName</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">tags</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">origName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dbEncoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extra_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SOCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># This isn&#39;t strictly true, since we *could* use backquotes or</span>
        <span class="c1"># &quot; or something (database-specific) around column names, but</span>
        <span class="c1"># why would anyone *want* to use a name like that?</span>
        <span class="c1"># @@: I suppose we could actually add backquotes to the</span>
        <span class="c1"># dbName if we needed to...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forceDBName</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlIdentifier</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">(</span>
                <span class="s1">&#39;Name must be SQL-safe &#39;</span>
                <span class="s1">&#39;(letters, numbers, underscores): </span><span class="si">%s</span><span class="s1"> (or use forceDBName=True)&#39;</span>
                <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="s1">&#39;The column name &quot;id&quot; is reserved for SQLObject use &#39;</span>
            <span class="s1">&#39;(and is implicitly created).&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;You must provide a name for all columns&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columnDef</span> <span class="o">=</span> <span class="n">columnDef</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creationOrder</span> <span class="o">=</span> <span class="n">creationOrder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">immutable</span> <span class="o">=</span> <span class="n">immutable</span>

        <span class="c1"># cascade can be one of:</span>
        <span class="c1"># None: no constraint is generated</span>
        <span class="c1"># True: a CASCADE constraint is generated</span>
        <span class="c1"># False: a RESTRICT constraint is generated</span>
        <span class="c1"># &#39;null&#39;: a SET NULL trigger is generated</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cascade</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">cascade</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;The only string value allowed for cascade is &#39;null&#39; &quot;</span>
                <span class="s2">&quot;(you gave: </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">cascade</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="o">=</span> <span class="n">cascade</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">constraints</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoConstraints</span><span class="p">()</span> <span class="o">+</span> <span class="n">constraints</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">notNull</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span> <span class="o">=</span> <span class="n">notNull</span>
            <span class="k">assert</span> <span class="n">notNone</span> <span class="ow">is</span> <span class="n">NoDefault</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">notNone</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="ow">not</span> <span class="n">notNull</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;The notNull and notNone arguments are aliases, &quot;</span>
                <span class="s2">&quot;and must not conflict.  &quot;</span>
                <span class="s2">&quot;You gave notNull=</span><span class="si">%r</span><span class="s2">, notNone=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">notNull</span><span class="p">,</span> <span class="n">notNone</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">notNone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span> <span class="o">=</span> <span class="n">notNone</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">notNull</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span> <span class="o">=</span> <span class="n">soClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultSQL</span> <span class="o">=</span> <span class="n">defaultSQL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span> <span class="o">=</span> <span class="n">sqlType</span>

        <span class="c1"># deal with foreign keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span> <span class="o">=</span> <span class="n">foreignKey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">origName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">idname</span> <span class="o">=</span> <span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">instanceAttrToIDAttr</span><span class="p">(</span><span class="n">origName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idname</span> <span class="o">=</span> <span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">instanceAttrToIDAttr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">idname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">foreignName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">idname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">foreignName</span> <span class="o">=</span> <span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span>\
                    <span class="n">instanceIDAttrToAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">foreignName</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># if they don&#39;t give us a specific database name for</span>
        <span class="c1"># the column, we separate the mixedCase into mixed_case</span>
        <span class="c1"># and assume that.</span>
        <span class="k">if</span> <span class="n">dbName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span> <span class="o">=</span> <span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">pythonAttrToDBColumn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span> <span class="o">=</span> <span class="n">dbName</span>

        <span class="c1"># alternateID means that this is a unique column that</span>
        <span class="c1"># can be used to identify rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternateID</span> <span class="o">=</span> <span class="n">alternateID</span>

        <span class="k">if</span> <span class="n">unique</span> <span class="ow">is</span> <span class="n">NoDefault</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">alternateID</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">and</span> <span class="n">alternateMethodName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alternateMethodName</span> <span class="o">=</span> <span class="s1">&#39;by&#39;</span> <span class="o">+</span> <span class="n">capword</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alternateMethodName</span> <span class="o">=</span> <span class="n">alternateMethodName</span>

        <span class="n">_validators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">validator</span><span class="p">:</span>
            <span class="n">_validators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validator2</span><span class="p">:</span>
            <span class="n">_validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validator2</span><span class="p">)</span>
        <span class="n">_vlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_validators</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_vlen</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_validator</span> <span class="ow">in</span> <span class="n">_validators</span><span class="p">:</span>
                <span class="n">_validator</span><span class="o">.</span><span class="n">soCol</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_vlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Set sef.{from,to}_python</span>
        <span class="k">elif</span> <span class="n">_vlen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">_validators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">_vlen</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">All</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">_validators</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">_validators</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noCache</span> <span class="o">=</span> <span class="n">noCache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="n">lazy</span>
        <span class="c1"># this is in case of ForeignKey, where we rename the column</span>
        <span class="c1"># and append an ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origName</span> <span class="o">=</span> <span class="n">origName</span> <span class="ow">or</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbEncoding</span> <span class="o">=</span> <span class="n">dbEncoding</span>

        <span class="k">if</span> <span class="n">extra_vars</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extra_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_python</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="o">.</span><span class="n">to_python</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_python</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span><span class="o">.</span><span class="n">from_python</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_python</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_python</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validator</span>

    <span class="n">validator</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_validator</span><span class="p">,</span> <span class="n">_set_validator</span><span class="p">)</span>

<div class="viewcode-block" id="SOCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a list of validators for the column.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="SOCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div>

    <span class="k">def</span> <span class="nf">_get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># A default can be a callback or a plain value,</span>
        <span class="c1"># here we resolve the callback</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span> <span class="ow">is</span> <span class="n">NoDefault</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NoDefault</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">,</span> <span class="s1">&#39;__sqlrepr__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default</span>
    <span class="n">default</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_default</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_joinName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">instanceIDAttrToAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">joinName</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_joinName</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="s1">&#39; default=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="s1">&#39; connected to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternateID</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="s1">&#39; alternate ID&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="s1">&#39; not null&#39;</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>

<div class="viewcode-block" id="SOCol.createSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.createSQL">[docs]</a>    <span class="k">def</span> <span class="nf">createSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_extraSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternateID</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NOT NULL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternateID</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;UNIQUE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultSQL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DEFAULT </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultSQL</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Col </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) cannot be used for automatic &quot;</span>
                             <span class="s2">&quot;schema creation (too abstract)&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># SQLite is naturally typeless, so as a fallback it uses</span>
        <span class="c1"># no type.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

<div class="viewcode-block" id="SOCol.mysqlCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.mysqlCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">mysqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mysqlType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

<div class="viewcode-block" id="SOCol.postgresCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.postgresCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">postgresCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postgresType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

<div class="viewcode-block" id="SOCol.sqliteCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.sqliteCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">sqliteCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqliteType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

<div class="viewcode-block" id="SOCol.sybaseCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.sybaseCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">sybaseCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sybaseType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

<div class="viewcode-block" id="SOCol.mssqlCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.mssqlCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">mssqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mssqlType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

<div class="viewcode-block" id="SOCol.firebirdCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.firebirdCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">firebirdCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Ian Sparks pointed out that fb is picky about the order</span>
        <span class="c1"># of the NOT NULL clause in a create statement.  So, we handle</span>
        <span class="c1"># them differently for Enum columns.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">SOEnumCol</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firebirdType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_firebirdType</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_firebirdType</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span></div>

<div class="viewcode-block" id="SOCol.maxdbCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.maxdbCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">maxdbCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxdbType</span><span class="p">()]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraSQL</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># class attribute, return the descriptor itself</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_obsolete</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The object &lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt; is obsolete&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">cacheColumns</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_columnCache</span>
            <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">loadValues</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">columns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># noqa</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">loadColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">loadColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;The column </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> is immutable&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">setColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;I can&#39;t be deleted from </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="p">)</span>

<div class="viewcode-block" id="SOCol.getDbEncoding"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCol.getDbEncoding">[docs]</a>    <span class="k">def</span> <span class="nf">getDbEncoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbEncoding</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbEncoding</span>
        <span class="n">dbEncoding</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">dbEncoding</span>
        <span class="k">if</span> <span class="n">dbEncoding</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dbEncoding</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">dbEncoding</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dbEncoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s2">&quot;dbEncoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dbEncoding</span><span class="p">:</span>
            <span class="n">dbEncoding</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">dbEncoding</span></div></div>


<div class="viewcode-block" id="Col"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.Col">[docs]</a><span class="k">class</span> <span class="nc">Col</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOCol</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Col</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_kw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;creationOrder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">creationOrder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_extra_vars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;You cannot change a name after it has already been set &quot;</span>
            <span class="s2">&quot;(from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_name</span><span class="p">,</span> <span class="n">_set_name</span><span class="p">)</span>

<div class="viewcode-block" id="Col.withClass"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.Col.withClass">[docs]</a>    <span class="k">def</span> <span class="nf">withClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soClass</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="p">(</span><span class="n">soClass</span><span class="o">=</span><span class="n">soClass</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                              <span class="n">creationOrder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">creationOrder</span><span class="p">,</span>
                              <span class="n">columnDef</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">extra_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_vars</span><span class="p">,</span>
                              <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_kw</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Col</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_vars</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)))[</span><span class="mi">2</span><span class="p">:],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">or</span> <span class="s1">&#39;(unnamed)&#39;</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">SOValidator</span><span class="p">(</span><span class="n">validators</span><span class="o">.</span><span class="n">Validator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getDbEncoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbEncoding</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soCol</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>


<div class="viewcode-block" id="SOStringLikeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOStringLikeCol">[docs]</a><span class="k">class</span> <span class="nc">SOStringLikeCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A common ancestor for SOStringCol and SOUnicodeCol&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;varchar&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_binary</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;char_binary&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># A hack for MySQL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span><span class="p">,</span> \
                <span class="s2">&quot;Without a length strings are treated as TEXT, not varchar&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SOStringLikeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOStringLikeCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOStringLikeCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isString</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">MaxLength</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">constraints</span></div>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;TEXT&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;VARCHAR(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;CHAR(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span> <span class="nf">_check_case_sensitive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_binary</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not support &quot;</span>
                             <span class="s2">&quot;binary character columns&quot;</span> <span class="o">%</span> <span class="n">db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_binary</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">+=</span> <span class="s2">&quot; BINARY&quot;</span>
        <span class="k">return</span> <span class="nb">type</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_case_sensitive</span><span class="p">(</span><span class="s2">&quot;PostgreSQL&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SOStringLikeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_postgresType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_case_sensitive</span><span class="p">(</span><span class="s2">&quot;SQLite&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SOStringLikeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_sqliteType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_case_sensitive</span><span class="p">(</span><span class="s2">&quot;SYBASE&quot;</span><span class="p">)</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">type</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_max_types</span><span class="p">():</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(MAX)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(4000)&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CHAR(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">return</span> <span class="nb">type</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_case_sensitive</span><span class="p">(</span><span class="s2">&quot;FireBird&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;BLOB SUB_TYPE TEXT&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_case_sensitive</span><span class="p">(</span><span class="s2">&quot;SAP DB/MaxDB&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;LONG ASCII&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqlType</span><span class="p">()</span></div>


<span class="k">class</span> <span class="nc">StringValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
            <span class="n">binaryType</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">_binaryType</span>
            <span class="n">dbName</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">dbName</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">binaryType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Just a simple workaround</span>
        <span class="n">dbEncoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataType</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataType</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                      <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">buffer_type</span><span class="p">,</span> <span class="n">binaryType</span><span class="p">,</span>
                       <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__unicode__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dbName</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a str in the StringCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOStringCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOStringCol">[docs]</a><span class="k">class</span> <span class="nc">SOStringCol</span><span class="p">(</span><span class="n">SOStringLikeCol</span><span class="p">):</span>

<div class="viewcode-block" id="SOStringCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOStringCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">StringValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="n">dataType</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOStringCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="StringCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.StringCol">[docs]</a><span class="k">class</span> <span class="nc">StringCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOStringCol</span></div>


<span class="k">class</span> <span class="nc">NQuoted</span><span class="p">(</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sqlrepr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">db</span> <span class="o">==</span> <span class="s1">&#39;mssql&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;N&quot;</span> <span class="o">+</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UnicodeStringValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">unicode_type</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>  <span class="c1"># MySQL</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__unicode__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a str or a unicode in the UnicodeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">dbName</span> <span class="o">==</span> <span class="s1">&#39;mssql&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">NQuoted</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__unicode__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a str or a unicode in the UnicodeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOUnicodeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOUnicodeCol">[docs]</a><span class="k">class</span> <span class="nc">SOUnicodeCol</span><span class="p">(</span><span class="n">SOStringLikeCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customSQLType</span>
        <span class="k">return</span> <span class="s1">&#39;N&#39;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span><span class="n">SOUnicodeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_mssqlType</span><span class="p">()</span>

<div class="viewcode-block" id="SOUnicodeCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOUnicodeCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UnicodeStringValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOUnicodeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="UnicodeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.UnicodeCol">[docs]</a><span class="k">class</span> <span class="nc">UnicodeCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOUnicodeCol</span></div>


<span class="k">class</span> <span class="nc">IntValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">converter</span><span class="p">,</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;__int__&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="s1">&#39;__long__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected an int in the IntCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOIntCol">[docs]</a><span class="k">class</span> <span class="nc">SOIntCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="c1"># 3-03 @@: support precision, maybe max and min directly</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unsigned</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;unsigned&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zerofill</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;zerofill&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">SOCol</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOIntCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOIntCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isInt</span><span class="p">]</span></div>

<div class="viewcode-block" id="SOIntCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOIntCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">IntValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOIntCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

<div class="viewcode-block" id="SOIntCol.addSQLAttrs"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOIntCol.addSQLAttrs">[docs]</a>    <span class="k">def</span> <span class="nf">addSQLAttrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">_ret</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="k">if</span> <span class="nb">str</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_ret</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsigned</span><span class="p">:</span>
            <span class="n">_ret</span> <span class="o">=</span> <span class="n">_ret</span> <span class="o">+</span> <span class="s2">&quot; UNSIGNED&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zerofill</span><span class="p">:</span>
            <span class="n">_ret</span> <span class="o">=</span> <span class="n">_ret</span> <span class="o">+</span> <span class="s2">&quot; ZEROFILL&quot;</span>
        <span class="k">return</span> <span class="n">_ret</span></div>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSQLAttrs</span><span class="p">(</span><span class="s2">&quot;INT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.IntCol">[docs]</a><span class="k">class</span> <span class="nc">IntCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOIntCol</span></div>


<div class="viewcode-block" id="SOTinyIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTinyIntCol">[docs]</a><span class="k">class</span> <span class="nc">SOTinyIntCol</span><span class="p">(</span><span class="n">SOIntCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSQLAttrs</span><span class="p">(</span><span class="s2">&quot;TINYINT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TinyIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.TinyIntCol">[docs]</a><span class="k">class</span> <span class="nc">TinyIntCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOTinyIntCol</span></div>


<div class="viewcode-block" id="SOSmallIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOSmallIntCol">[docs]</a><span class="k">class</span> <span class="nc">SOSmallIntCol</span><span class="p">(</span><span class="n">SOIntCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSQLAttrs</span><span class="p">(</span><span class="s2">&quot;SMALLINT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SmallIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SmallIntCol">[docs]</a><span class="k">class</span> <span class="nc">SmallIntCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOSmallIntCol</span></div>


<div class="viewcode-block" id="SOMediumIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOMediumIntCol">[docs]</a><span class="k">class</span> <span class="nc">SOMediumIntCol</span><span class="p">(</span><span class="n">SOIntCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSQLAttrs</span><span class="p">(</span><span class="s2">&quot;MEDIUMINT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MediumIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.MediumIntCol">[docs]</a><span class="k">class</span> <span class="nc">MediumIntCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOMediumIntCol</span></div>


<div class="viewcode-block" id="SOBigIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBigIntCol">[docs]</a><span class="k">class</span> <span class="nc">SOBigIntCol</span><span class="p">(</span><span class="n">SOIntCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSQLAttrs</span><span class="p">(</span><span class="s2">&quot;BIGINT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BigIntCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.BigIntCol">[docs]</a><span class="k">class</span> <span class="nc">BigIntCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOBigIntCol</span></div>


<span class="k">class</span> <span class="nc">BoolValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__nonzero__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a bool or an int in the BoolCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOBoolCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBoolCol">[docs]</a><span class="k">class</span> <span class="nc">SOBoolCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
<div class="viewcode-block" id="SOBoolCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBoolCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isBool</span><span class="p">]</span></div>

<div class="viewcode-block" id="SOBoolCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBoolCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">BoolValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOBoolCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;BOOL&#39;</span>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BOOL&quot;</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BIT&quot;</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BIT&quot;</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;INT&#39;</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BOOLEAN&quot;</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;BOOLEAN&quot;</span></div>


<div class="viewcode-block" id="BoolCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.BoolCol">[docs]</a><span class="k">class</span> <span class="nc">BoolCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOBoolCol</span></div>


<span class="k">class</span> <span class="nc">FloatValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">converter</span><span class="p">,</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;__float__&#39;</span><span class="p">),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;__int__&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="s1">&#39;__long__&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a float in the FloatCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOFloatCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOFloatCol">[docs]</a><span class="k">class</span> <span class="nc">SOFloatCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="c1"># 3-03 @@: support precision (e.g., DECIMAL)</span>

<div class="viewcode-block" id="SOFloatCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOFloatCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isFloat</span><span class="p">]</span></div>

<div class="viewcode-block" id="SOFloatCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOFloatCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">FloatValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOFloatCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;FLOAT&#39;</span>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;DOUBLE PRECISION&quot;</span></div>


<div class="viewcode-block" id="FloatCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.FloatCol">[docs]</a><span class="k">class</span> <span class="nc">FloatCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOFloatCol</span></div>


<div class="viewcode-block" id="SOKeyCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOKeyCol">[docs]</a><span class="k">class</span> <span class="nc">SOKeyCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="n">key_type</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">:</span> <span class="s2">&quot;INT&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">}</span>

    <span class="c1"># 3-03 @@: this should have a simplified constructor</span>
    <span class="c1"># Should provide foreign key information for other DBs.</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;refColumn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOKeyCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_idType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_idType</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">key_type</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">:</span> <span class="s2">&quot;NUMERIC(18,0)&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">key_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_idType</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">key_type</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">:</span> <span class="s2">&quot;INT&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">key_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_idType</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">key_type</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">:</span> <span class="s2">&quot;INT&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">:</span> <span class="s2">&quot;VARCHAR(255)&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">key_type</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_idType</span><span class="p">()]</span></div>


<div class="viewcode-block" id="KeyCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.KeyCol">[docs]</a><span class="k">class</span> <span class="nc">KeyCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>

    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOKeyCol</span></div>


<span class="k">class</span> <span class="nc">ForeignKeyValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ForeignKeyValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fkIDType</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Avoid importing the main module</span>
        <span class="c1"># to get the SQLObject class for isinstance</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqlmeta&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fkIDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">otherTable</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soCol</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">soCol</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fkIDType</span> <span class="o">=</span> <span class="n">otherTable</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fkIDType</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span><span class="s2">&quot;expected a </span><span class="si">%r</span><span class="s2"> for the ForeignKey &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
                                 <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fkIDType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                  <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOForeignKey"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey">[docs]</a><span class="k">class</span> <span class="nc">SOForeignKey</span><span class="p">(</span><span class="n">SOKeyCol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">foreignKey</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;foreignKey&#39;</span><span class="p">]</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;soClass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">style</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;origName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">instanceAttrToIDAttr</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">instanceAttrToIDAttr</span><span class="p">(</span>
                <span class="n">style</span><span class="o">.</span><span class="n">pythonClassToAttr</span><span class="p">(</span><span class="n">foreignKey</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOForeignKey</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOForeignKey.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ForeignKeyValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOForeignKey</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_idType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idType</span>

<div class="viewcode-block" id="SOForeignKey.sqliteCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.sqliteCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">sqliteCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">SOKeyCol</span><span class="o">.</span><span class="n">sqliteCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE SET NULL&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE CASCADE&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE RESTRICT&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CONSTRAINT </span><span class="si">%(colName)s</span><span class="s1">_exists &#39;</span>
                      <span class="c1"># &#39;FOREIGN KEY(%(colName)s) &#39;</span>
                      <span class="s1">&#39;REFERENCES </span><span class="si">%(tName)s</span><span class="s1">(</span><span class="si">%(idName)s</span><span class="s1">) &#39;</span>
                      <span class="s1">&#39;</span><span class="si">%(action)s</span><span class="s1">&#39;</span> <span class="o">%</span>
                      <span class="p">{</span><span class="s1">&#39;tName&#39;</span><span class="p">:</span> <span class="n">tName</span><span class="p">,</span>
                       <span class="s1">&#39;colName&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
                       <span class="s1">&#39;idName&#39;</span><span class="p">:</span> <span class="n">idName</span><span class="p">,</span>
                       <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">})</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sql</span><span class="p">,</span> <span class="n">constraint</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sql</span></div>

<div class="viewcode-block" id="SOForeignKey.postgresCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.postgresCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">postgresCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">SOKeyCol</span><span class="o">.</span><span class="n">postgresCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sql</span></div>

<div class="viewcode-block" id="SOForeignKey.postgresCreateReferenceConstraint"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.postgresCreateReferenceConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">postgresCreateReferenceConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sTName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE SET NULL&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE CASCADE&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE RESTRICT&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ALTER TABLE </span><span class="si">%(sTName)s</span><span class="s1"> &#39;</span>
                      <span class="s1">&#39;ADD CONSTRAINT </span><span class="si">%(colName)s</span><span class="s1">_exists &#39;</span>
                      <span class="s1">&#39;FOREIGN KEY (</span><span class="si">%(colName)s</span><span class="s1">) &#39;</span>
                      <span class="s1">&#39;REFERENCES </span><span class="si">%(tName)s</span><span class="s1"> (</span><span class="si">%(idName)s</span><span class="s1">) &#39;</span>
                      <span class="s1">&#39;</span><span class="si">%(action)s</span><span class="s1">&#39;</span> <span class="o">%</span>
                      <span class="p">{</span><span class="s1">&#39;tName&#39;</span><span class="p">:</span> <span class="n">tName</span><span class="p">,</span>
                       <span class="s1">&#39;colName&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
                       <span class="s1">&#39;idName&#39;</span><span class="p">:</span> <span class="n">idName</span><span class="p">,</span>
                       <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
                       <span class="s1">&#39;sTName&#39;</span><span class="p">:</span> <span class="n">sTName</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">constraint</span></div>

<div class="viewcode-block" id="SOForeignKey.mysqlCreateReferenceConstraint"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.mysqlCreateReferenceConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">mysqlCreateReferenceConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sTName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">sTLocalName</span> <span class="o">=</span> <span class="n">sTName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE SET NULL&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cascade</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE CASCADE&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;ON DELETE RESTRICT&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ALTER TABLE </span><span class="si">%(sTName)s</span><span class="s1"> &#39;</span>
                      <span class="s1">&#39;ADD CONSTRAINT </span><span class="si">%(sTLocalName)s</span><span class="s1">_</span><span class="si">%(colName)s</span><span class="s1">_exists &#39;</span>
                      <span class="s1">&#39;FOREIGN KEY (</span><span class="si">%(colName)s</span><span class="s1">) &#39;</span>
                      <span class="s1">&#39;REFERENCES </span><span class="si">%(tName)s</span><span class="s1"> (</span><span class="si">%(idName)s</span><span class="s1">) &#39;</span>
                      <span class="s1">&#39;</span><span class="si">%(action)s</span><span class="s1">&#39;</span> <span class="o">%</span>
                      <span class="p">{</span><span class="s1">&#39;tName&#39;</span><span class="p">:</span> <span class="n">tName</span><span class="p">,</span>
                       <span class="s1">&#39;colName&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
                       <span class="s1">&#39;idName&#39;</span><span class="p">:</span> <span class="n">idName</span><span class="p">,</span>
                       <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
                       <span class="s1">&#39;sTName&#39;</span><span class="p">:</span> <span class="n">sTName</span><span class="p">,</span>
                       <span class="s1">&#39;sTLocalName&#39;</span><span class="p">:</span> <span class="n">sTLocalName</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">constraint</span></div>

<div class="viewcode-block" id="SOForeignKey.mysqlCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.mysqlCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">mysqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SOKeyCol</span><span class="o">.</span><span class="n">mysqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span></div>

<div class="viewcode-block" id="SOForeignKey.sybaseCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.sybaseCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">sybaseCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">SOKeyCol</span><span class="o">.</span><span class="n">sybaseCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;REFERENCES </span><span class="si">%(tName)s</span><span class="s1">(</span><span class="si">%(idName)s</span><span class="s1">) &#39;</span> <span class="o">%</span>
                     <span class="p">{</span><span class="s1">&#39;tName&#39;</span><span class="p">:</span> <span class="n">tName</span><span class="p">,</span>
                      <span class="s1">&#39;idName&#39;</span><span class="p">:</span> <span class="n">idName</span><span class="p">})</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sql</span><span class="p">,</span> <span class="n">reference</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sql</span></div>

<div class="viewcode-block" id="SOForeignKey.sybaseCreateReferenceConstraint"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.sybaseCreateReferenceConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">sybaseCreateReferenceConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># @@: Code from above should be moved here</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SOForeignKey.mssqlCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.mssqlCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">mssqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">SOKeyCol</span><span class="o">.</span><span class="n">mssqlCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;REFERENCES </span><span class="si">%(tName)s</span><span class="s1">(</span><span class="si">%(idName)s</span><span class="s1">) &#39;</span> <span class="o">%</span>
                     <span class="p">{</span><span class="s1">&#39;tName&#39;</span><span class="p">:</span> <span class="n">tName</span><span class="p">,</span>
                      <span class="s1">&#39;idName&#39;</span><span class="p">:</span> <span class="n">idName</span><span class="p">})</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sql</span><span class="p">,</span> <span class="n">reference</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">sql</span></div>

<div class="viewcode-block" id="SOForeignKey.mssqlCreateReferenceConstraint"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.mssqlCreateReferenceConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">mssqlCreateReferenceConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># @@: Code from above should be moved here</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SOForeignKey.maxdbCreateSQL"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.maxdbCreateSQL">[docs]</a>    <span class="k">def</span> <span class="nf">maxdbCreateSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">findClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foreignKey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
        <span class="n">fidName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span>
        <span class="c1"># I assume that foreign key name is identical</span>
        <span class="c1"># to the id of the reference table</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fidName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxdbType</span><span class="p">()])</span>
        <span class="n">tName</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span>
        <span class="n">idName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refColumn</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">idName</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span> <span class="o">+</span> <span class="s1">&#39;FOREIGN KEY (</span><span class="si">%s</span><span class="s1">) REFERENCES </span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fidName</span><span class="p">,</span> <span class="n">tName</span><span class="p">,</span>
                                                            <span class="n">idName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sql</span></div>

<div class="viewcode-block" id="SOForeignKey.maxdbCreateReferenceConstraint"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOForeignKey.maxdbCreateReferenceConstraint">[docs]</a>    <span class="k">def</span> <span class="nf">maxdbCreateReferenceConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># @@: Code from above should be moved here</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="ForeignKey"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.ForeignKey">[docs]</a><span class="k">class</span> <span class="nc">ForeignKey</span><span class="p">(</span><span class="n">KeyCol</span><span class="p">):</span>

    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOForeignKey</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foreignKey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">foreignKey</span><span class="o">=</span><span class="n">foreignKey</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">EnumValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">:</span>
            <span class="c1"># Only encode on python 2 - on python 3, the database driver</span>
            <span class="c1"># will handle this</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">)</span> <span class="ow">and</span> <span class="n">PY2</span><span class="p">:</span>
                <span class="n">dbEncoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">notNone</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a member of </span><span class="si">%r</span><span class="s2"> in the EnumCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOEnumCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOEnumCol">[docs]</a><span class="k">class</span> <span class="nc">SOEnumCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;enumValues&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;You must provide an enumValues keyword argument&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOEnumCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOEnumCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOEnumCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isString</span><span class="p">,</span> <span class="n">constrs</span><span class="o">.</span><span class="n">InList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">)]</span></div>

<div class="viewcode-block" id="SOEnumCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOEnumCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EnumValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">enumValues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">,</span>
                              <span class="n">notNone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">notNone</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOEnumCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We need to map None in the enum expression to an appropriate</span>
        <span class="c1"># condition on NULL</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ENUM(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ENUM(</span><span class="si">%s</span><span class="s2">) NOT NULL&quot;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getlength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">))</span>
        <span class="n">enumValues</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;postgres&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">])</span>
        <span class="n">checkConstraint</span> <span class="o">=</span> <span class="s2">&quot;CHECK (</span><span class="si">%s</span><span class="s2"> in (</span><span class="si">%s</span><span class="s2">))&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="n">enumValues</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;VARCHAR(</span><span class="si">%i</span><span class="s2">) </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">checkConstraint</span><span class="p">)</span>

    <span class="n">_sqliteType</span> <span class="o">=</span> <span class="n">_postgresType</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postgresType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postgresType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getlength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">))</span>
        <span class="n">enumValues</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;firebird&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValues</span><span class="p">])</span>
        <span class="n">checkConstraint</span> <span class="o">=</span> <span class="s2">&quot;CHECK (</span><span class="si">%s</span><span class="s2"> in (</span><span class="si">%s</span><span class="s2">))&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="n">enumValues</span><span class="p">)</span>
        <span class="c1"># NB. Return a tuple, not a string here</span>
        <span class="k">return</span> <span class="s2">&quot;VARCHAR(</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="n">checkConstraint</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Enum type is not supported on MAX DB&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getlength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        None counts as 0; everything else uses len()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="EnumCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.EnumCol">[docs]</a><span class="k">class</span> <span class="nc">EnumCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOEnumCol</span></div>


<span class="k">class</span> <span class="nc">SetValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates Python tuples into SQL comma-delimited SET strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a string in the SetCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                <span class="s2">&quot;expected a string or a sequence of strings &quot;</span>
                <span class="s2">&quot;in the SetCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOSetCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOSetCol">[docs]</a><span class="k">class</span> <span class="nc">SOSetCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setValues</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;setValues&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">setValues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;You must provide a setValues keyword argument&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOSetCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOSetCol.autoConstraints"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOSetCol.autoConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">autoConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">constrs</span><span class="o">.</span><span class="n">isString</span><span class="p">,</span> <span class="n">constrs</span><span class="o">.</span><span class="n">InList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setValues</span><span class="p">)]</span></div>

<div class="viewcode-block" id="SOSetCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOSetCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">SetValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">setValues</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">setValues</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOSetCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SET(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">sqlrepr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setValues</span><span class="p">])</span></div>


<div class="viewcode-block" id="SetCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SetCol">[docs]</a><span class="k">class</span> <span class="nc">SetCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOSetCol</span></div>


<span class="k">class</span> <span class="nc">DateTimeValidator</span><span class="p">(</span><span class="n">validators</span><span class="o">.</span><span class="n">DateValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                       <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">mxdatetime_available</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DateTimeType</span><span class="p">):</span>
                <span class="c1"># convert mxDateTime instance to datetime</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;%H&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> \
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;%T&quot;</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                             <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                             <span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TimeType</span><span class="p">):</span>
                <span class="c1"># convert mxTime instance to time</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                         <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">microseconds</span> <span class="o">=</span> <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">microseconds</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">_l</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">microseconds</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="n">_l</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">_l</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">microseconds</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">_l</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">+=</span> <span class="s1">&#39;.0&#39;</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                <span class="s2">&quot;expected a date/time string of the &#39;</span><span class="si">%s</span><span class="s2">&#39; format &quot;</span>
                <span class="s2">&quot;in the DateTimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                       <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;strftime&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a datetime in the DateTimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mxdatetime_available</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MXDateTimeValidator</span><span class="p">(</span><span class="n">validators</span><span class="o">.</span><span class="n">DateValidator</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                          <span class="p">(</span><span class="n">DateTimeType</span><span class="p">,</span> <span class="n">TimeType</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                         <span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                         <span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                        <span class="s2">&quot;the value for the TimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39; must has days=0, &quot;</span>
                        <span class="s2">&quot;it has days=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span><span class="p">),</span>
                        <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">_value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                        <span class="n">microseconds</span> <span class="o">=</span> <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">microseconds</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">_l</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">microseconds</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="n">_l</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">_l</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="n">_value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">microseconds</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">_l</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="s1">&#39;.0&#39;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                         <span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                                         <span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                    <span class="s2">&quot;expected a date/time string of the &#39;</span><span class="si">%s</span><span class="s2">&#39; format &quot;</span>
                    <span class="s2">&quot;in the DateTimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                          <span class="p">(</span><span class="n">DateTimeType</span><span class="p">,</span> <span class="n">TimeType</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;strftime&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                <span class="s2">&quot;expected a mxDateTime in the DateTimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
                <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SODateTimeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODateTimeCol">[docs]</a><span class="k">class</span> <span class="nc">SODateTimeCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="n">datetimeFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">datetimeFormat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;datetimeFormat&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datetimeFormat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetimeFormat</span> <span class="o">=</span> <span class="n">datetimeFormat</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SODateTimeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SODateTimeCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODateTimeCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_validators</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SODateTimeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">DATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">DateTimeValidator</span>
        <span class="k">elif</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">MXDATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">MXDateTimeValidator</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span><span class="p">:</span>
            <span class="n">_validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validatorClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datetimeFormat</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_validators</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_microseconds</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;DATETIME(6)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;DATETIME&#39;</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIMESTAMP&#39;</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATETIME&#39;</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_microseconds</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;DATETIME2(6)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;DATETIME&#39;</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIMESTAMP&#39;</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIMESTAMP&#39;</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIMESTAMP&#39;</span></div>


<div class="viewcode-block" id="DateTimeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.DateTimeCol">[docs]</a><span class="k">class</span> <span class="nc">DateTimeCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SODateTimeCol</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DateTimeCol.now"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.DateTimeCol.now">[docs]</a>    <span class="k">def</span> <span class="nf">now</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">DATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">MXDATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DateTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;No datetime implementation available &quot;</span>
                       <span class="s2">&quot;(DATETIME_IMPLEMENTATION=</span><span class="si">%r</span><span class="s2">)&quot;</span>
                       <span class="o">%</span> <span class="n">DATETIME_IMPLEMENTATION</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">DateValidator</span><span class="p">(</span><span class="n">DateTimeValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DateValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SODateCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODateCol">[docs]</a><span class="k">class</span> <span class="nc">SODateCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="n">dateFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">dateFormat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dateFormat&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dateFormat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dateFormat</span> <span class="o">=</span> <span class="n">dateFormat</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SODateCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SODateCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODateCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a validator for the column.</span>

<span class="sd">        Can be overriden in descendants.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_validators</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SODateCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">DATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">DateValidator</span>
        <span class="k">elif</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">MXDATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">MXDateTimeValidator</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span><span class="p">:</span>
            <span class="n">_validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validatorClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dateFormat</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_validators</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATE&#39;</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATE&#39;</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postgresType</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SQL Server doesn&#39;t have  a DATE data type, to emulate we use a vc(10)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;VARCHAR(10)&#39;</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATE&#39;</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATE&#39;</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DATE&#39;</span></div>


<div class="viewcode-block" id="DateCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.DateCol">[docs]</a><span class="k">class</span> <span class="nc">DateCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SODateCol</span></div>


<span class="k">class</span> <span class="nc">TimeValidator</span><span class="p">(</span><span class="n">DateTimeValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                    <span class="s2">&quot;the value for the TimeCol &#39;</span><span class="si">%s</span><span class="s2">&#39; must has days=0, &quot;</span>
                    <span class="s2">&quot;it has days=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">seconds</span><span class="p">)[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TimeValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOTimeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTimeCol">[docs]</a><span class="k">class</span> <span class="nc">SOTimeCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="n">timeFormat</span> <span class="o">=</span> <span class="s1">&#39;%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">timeFormat</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timeFormat&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeFormat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeFormat</span> <span class="o">=</span> <span class="n">timeFormat</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOTimeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOTimeCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTimeCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_validators</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SOTimeCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">DATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">TimeValidator</span>
        <span class="k">elif</span> <span class="n">default_datetime_implementation</span> <span class="o">==</span> <span class="n">MXDATETIME_IMPLEMENTATION</span><span class="p">:</span>
            <span class="n">validatorClass</span> <span class="o">=</span> <span class="n">MXDateTimeValidator</span>
        <span class="k">if</span> <span class="n">default_datetime_implementation</span><span class="p">:</span>
            <span class="n">_validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validatorClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeFormat</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_validators</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_microseconds</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;TIME(6)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_sybaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_microseconds</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;TIME(6)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_sqliteType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_firebirdType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span>

    <span class="k">def</span> <span class="nf">_maxdbType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;TIME&#39;</span></div>


<div class="viewcode-block" id="TimeCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.TimeCol">[docs]</a><span class="k">class</span> <span class="nc">TimeCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOTimeCol</span></div>


<div class="viewcode-block" id="SOTimestampCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTimestampCol">[docs]</a><span class="k">class</span> <span class="nc">SOTimestampCol</span><span class="p">(</span><span class="n">SODateTimeCol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Necessary to support MySQL&#39;s use of TIMESTAMP versus DATETIME types</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">SOCol</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_microseconds</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;TIMESTAMP(6)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;TIMESTAMP&#39;</span></div>


<div class="viewcode-block" id="TimestampCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.TimestampCol">[docs]</a><span class="k">class</span> <span class="nc">TimestampCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOTimestampCol</span></div>


<span class="k">class</span> <span class="nc">TimedeltaValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">from_python</span> <span class="o">=</span> <span class="n">to_python</span>


<div class="viewcode-block" id="SOTimedeltaCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTimedeltaCol">[docs]</a><span class="k">class</span> <span class="nc">SOTimedeltaCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;INTERVAL&#39;</span>

<div class="viewcode-block" id="SOTimedeltaCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOTimedeltaCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TimedeltaValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOTimedeltaCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TimedeltaCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.TimedeltaCol">[docs]</a><span class="k">class</span> <span class="nc">TimedeltaCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOTimedeltaCol</span></div>


<span class="k">class</span> <span class="nc">DecimalValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s2">&quot;decimalSeparator&quot;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">decimalSeparator</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                <span class="s2">&quot;expected a Decimal in the DecimalCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
                <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s2">&quot;decimalSeparator&quot;</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">decimalSeparator</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
                    <span class="s2">&quot;can not parse Decimal value &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span>
                    <span class="s2">&quot;in the DecimalCol from &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">value</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s1">&#39;soObject&#39;</span><span class="p">,</span> <span class="s1">&#39;(unknown)&#39;</span><span class="p">)),</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLExpression</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a Decimal in the DecimalCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SODecimalCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODecimalCol">[docs]</a><span class="k">class</span> <span class="nc">SODecimalCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">NoDefault</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">,</span> \
            <span class="s2">&quot;You must give a size argument&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="n">NoDefault</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">,</span> \
            <span class="s2">&quot;You must give a precision argument&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SODecimalCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DECIMAL(</span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>

<div class="viewcode-block" id="SODecimalCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODecimalCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">DecimalValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SODecimalCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DecimalCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.DecimalCol">[docs]</a><span class="k">class</span> <span class="nc">DecimalCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SODecimalCol</span></div>


<div class="viewcode-block" id="SOCurrencyCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOCurrencyCol">[docs]</a><span class="k">class</span> <span class="nc">SOCurrencyCol</span><span class="p">(</span><span class="n">SODecimalCol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">pushKey</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">pushKey</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOCurrencyCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="CurrencyCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.CurrencyCol">[docs]</a><span class="k">class</span> <span class="nc">CurrencyCol</span><span class="p">(</span><span class="n">DecimalCol</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOCurrencyCol</span></div>


<span class="k">class</span> <span class="nc">DecimalStringValidator</span><span class="p">(</span><span class="n">DecimalValidator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DecimalStringValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> \
                <span class="s2">&quot;Value must be less than </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DecimalStringValidator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_python</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> \
                    <span class="s2">&quot;Value must be less than </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_eng_string</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<div class="viewcode-block" id="SODecimalStringCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODecimalStringCol">[docs]</a><span class="k">class</span> <span class="nc">SODecimalStringCol</span><span class="p">(</span><span class="n">SOStringCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="n">NoDefault</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> \
            <span class="s2">&quot;You must give a size argument as a positive integer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="n">NoDefault</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefault</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> \
            <span class="s2">&quot;You must give a precision argument as a positive integer&quot;</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantize</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;quantize&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantize</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> \
            <span class="s2">&quot;quantize argument must be Boolean True/False&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SODecimalStringCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SODecimalStringCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SODecimalStringCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantize</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">DecimalStringValidator</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
                <span class="nb">max</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">DecimalStringValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SODecimalStringCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">(</span><span class="n">dataType</span><span class="o">=</span><span class="n">Decimal</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DecimalStringCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.DecimalStringCol">[docs]</a><span class="k">class</span> <span class="nc">DecimalStringCol</span><span class="p">(</span><span class="n">StringCol</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SODecimalStringCol</span></div>


<span class="k">class</span> <span class="nc">BinaryValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator for binary types.</span>

<span class="sd">    We&#39;re assuming that the per-database modules provide some form</span>
<span class="sd">    of wrapper type for binary conversion.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_cachedValue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">dbName</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">binaryType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Just a simple workaround</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dbName</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">dbName</span>
            <span class="n">binaryType</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">_binaryType</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dbName</span> <span class="o">==</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dbName</span> <span class="o">==</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">PY2</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">buffer_type</span><span class="p">,</span> <span class="n">binaryType</span><span class="p">)):</span>
            <span class="n">cachedValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cachedValue</span>
            <span class="k">if</span> <span class="n">cachedValue</span> <span class="ow">and</span> <span class="n">cachedValue</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cachedValue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>  <span class="c1"># MySQL</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># buffer =&gt; string</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a string in the BLOBCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">soObject</span><span class="o">.</span><span class="n">_connection</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">createBinary</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">):</span>
            <span class="n">binary</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">binary</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cachedValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">binary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">binary</span>


<div class="viewcode-block" id="SOBLOBCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBLOBCol">[docs]</a><span class="k">class</span> <span class="nc">SOBLOBCol</span><span class="p">(</span><span class="n">SOStringCol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c1"># Change the default from &#39;auto&#39; to False -</span>
        <span class="c1"># this is a (mostly) binary column</span>
        <span class="k">if</span> <span class="s1">&#39;varchar&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;varchar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOBLOBCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOBLOBCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOBLOBCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">BinaryValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOBLOBCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">varchar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varchar</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">24</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">varchar</span> <span class="ow">and</span> <span class="s2">&quot;LONGTEXT&quot;</span> <span class="ow">or</span> <span class="s2">&quot;LONGBLOB&quot;</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">varchar</span> <span class="ow">and</span> <span class="s2">&quot;MEDIUMTEXT&quot;</span> <span class="ow">or</span> <span class="s2">&quot;MEDIUMBLOB&quot;</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">varchar</span> <span class="ow">and</span> <span class="s2">&quot;TEXT&quot;</span> <span class="ow">or</span> <span class="s2">&quot;BLOB&quot;</span>
        <span class="k">return</span> <span class="n">varchar</span> <span class="ow">and</span> <span class="s2">&quot;TINYTEXT&quot;</span> <span class="ow">or</span> <span class="s2">&quot;TINYBLOB&quot;</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;BYTEA&#39;</span>

    <span class="k">def</span> <span class="nf">_mssqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">can_use_max_types</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;VARBINARY(MAX)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;IMAGE&quot;</span></div>


<div class="viewcode-block" id="BLOBCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.BLOBCol">[docs]</a><span class="k">class</span> <span class="nc">BLOBCol</span><span class="p">(</span><span class="n">StringCol</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOBLOBCol</span></div>


<span class="k">class</span> <span class="nc">PickleValidator</span><span class="p">(</span><span class="n">BinaryValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator for pickle types.  A pickle type is simply a binary type</span>
<span class="sd">    with hidden pickling, so that we can simply store any kind of</span>
<span class="sd">    stuff in a particular column.</span>

<span class="sd">    The support for this relies directly on the support for binary for</span>
<span class="sd">    your database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unicode_type</span><span class="p">):</span>
            <span class="n">dbEncoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDbEncoding</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dbEncoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a pickle string in the PickleCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pickleProtocol</span><span class="p">)</span>


<div class="viewcode-block" id="SOPickleCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOPickleCol">[docs]</a><span class="k">class</span> <span class="nc">SOPickleCol</span><span class="p">(</span><span class="n">SOBLOBCol</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickleProtocol</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pickleProtocol&#39;</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SOPickleCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<div class="viewcode-block" id="SOPickleCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOPickleCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PickleValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">pickleProtocol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pickleProtocol</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOPickleCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_mysqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">24</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;LONGBLOB&quot;</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;MEDIUMBLOB&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;BLOB&quot;</span></div>


<div class="viewcode-block" id="PickleCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.PickleCol">[docs]</a><span class="k">class</span> <span class="nc">PickleCol</span><span class="p">(</span><span class="n">BLOBCol</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOPickleCol</span></div>


<span class="k">class</span> <span class="nc">UuidValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected string in the UuidCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected uuid in the UuidCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOUuidCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOUuidCol">[docs]</a><span class="k">class</span> <span class="nc">SOUuidCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
<div class="viewcode-block" id="SOUuidCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOUuidCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">UuidValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOUuidCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_sqlType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;VARCHAR(36)&#39;</span>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;UUID&#39;</span></div>


<div class="viewcode-block" id="UuidCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.UuidCol">[docs]</a><span class="k">class</span> <span class="nc">UuidCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOUuidCol</span></div>


<span class="k">class</span> <span class="nc">JsonbValidator</span><span class="p">(</span><span class="n">SOValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">unicode</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expect one of the following types &quot;</span>
            <span class="s2">&quot;(dict, list, unicode, int, long, float, bool) for &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOJsonbCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOJsonbCol">[docs]</a><span class="k">class</span> <span class="nc">SOJsonbCol</span><span class="p">(</span><span class="n">SOCol</span><span class="p">):</span>
<div class="viewcode-block" id="SOJsonbCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOJsonbCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">JsonbValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOJsonbCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_postgresType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;JSONB&#39;</span></div>


<div class="viewcode-block" id="JsonbCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.JsonbCol">[docs]</a><span class="k">class</span> <span class="nc">JsonbCol</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOJsonbCol</span></div>


<span class="k">class</span> <span class="nc">JSONValidator</span><span class="p">(</span><span class="n">StringValidator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected a JSON str in the JSONCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                      <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">long</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">string_type</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">validators</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span>
            <span class="s2">&quot;expected an object suitable for JSON in the JSONCol &#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">%s</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>


<div class="viewcode-block" id="SOJSONCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOJSONCol">[docs]</a><span class="k">class</span> <span class="nc">SOJSONCol</span><span class="p">(</span><span class="n">SOStringCol</span><span class="p">):</span>

<div class="viewcode-block" id="SOJSONCol.createValidators"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.SOJSONCol.createValidators">[docs]</a>    <span class="k">def</span> <span class="nf">createValidators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">JSONValidator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">+</span> \
            <span class="nb">super</span><span class="p">(</span><span class="n">SOJSONCol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">createValidators</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="JSONCol"><a class="viewcode-back" href="../../api/sqlobject.col.html#sqlobject.col.JSONCol">[docs]</a><span class="k">class</span> <span class="nc">JSONCol</span><span class="p">(</span><span class="n">StringCol</span><span class="p">):</span>
    <span class="n">baseClass</span> <span class="o">=</span> <span class="n">SOJSONCol</span></div>


<span class="k">def</span> <span class="nf">pushKey</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">kw</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="nb">all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Use copy() to avoid &#39;dictionary changed&#39; issues on python 3</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Col</span><span class="p">,</span> <span class="n">SOCol</span><span class="p">))):</span>
        <span class="nb">all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">__all__</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
<span class="k">del</span> <span class="nb">all</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2017, Ian Bicking and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>