

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sqlobject.inheritance &#8212; SQLObject 3.2.0a0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2.0a0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="SQLObject 3.2.0a0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.2.0a0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sqlobject.inheritance</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>

<span class="kn">from</span> <span class="nn">sqlobject</span> <span class="k">import</span> <span class="n">dbconnection</span>
<span class="kn">from</span> <span class="nn">sqlobject</span> <span class="k">import</span> <span class="n">classregistry</span>
<span class="kn">from</span> <span class="nn">sqlobject</span> <span class="k">import</span> <span class="n">events</span>
<span class="kn">from</span> <span class="nn">sqlobject</span> <span class="k">import</span> <span class="n">sqlbuilder</span>
<span class="kn">from</span> <span class="nn">sqlobject.col</span> <span class="k">import</span> <span class="n">StringCol</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlobject.main</span> <span class="k">import</span> <span class="n">sqlmeta</span><span class="p">,</span> <span class="n">SQLObject</span><span class="p">,</span> <span class="n">SelectResults</span><span class="p">,</span> \
    <span class="n">makeProperties</span><span class="p">,</span> <span class="n">unmakeProperties</span><span class="p">,</span> <span class="n">getterName</span><span class="p">,</span> <span class="n">setterName</span>
<span class="kn">from</span> <span class="nn">sqlobject.compat</span> <span class="k">import</span> <span class="n">string_type</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">iteration</span>


<span class="k">def</span> <span class="nf">tablesUsedSet</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;tablesUsedSet&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tablesUsedSet</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tablesUsedSet</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">InheritableSelectResults</span><span class="p">(</span><span class="n">SelectResults</span><span class="p">):</span>
    <span class="n">IterationClass</span> <span class="o">=</span> <span class="n">iteration</span><span class="o">.</span><span class="n">InheritableIteration</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceClass</span><span class="p">,</span> <span class="n">clause</span><span class="p">,</span> <span class="n">clauseTables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">inheritedTables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">ops</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">clause</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">clause</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">clause</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLTrueClause</span>

        <span class="n">dbName</span> <span class="o">=</span> <span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="n">sourceClass</span><span class="o">.</span><span class="n">_connection</span><span class="p">)</span><span class="o">.</span><span class="n">dbName</span>

        <span class="n">tablesSet</span> <span class="o">=</span> <span class="n">tablesUsedSet</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">dbName</span><span class="p">)</span>
        <span class="n">tablesSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sourceClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>
        <span class="n">orderBy</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;orderBy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inheritedTables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tableName</span> <span class="ow">in</span> <span class="n">inheritedTables</span><span class="p">:</span>
                <span class="n">tablesSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tableName</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">orderBy</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orderBy</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
            <span class="n">tablesSet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tablesUsedSet</span><span class="p">(</span><span class="n">orderBy</span><span class="p">,</span> <span class="n">dbName</span><span class="p">))</span>
        <span class="c1"># DSM: if this class has a parent, we need to link it</span>
        <span class="c1"># DSM: and be sure the parent is in the table list.</span>
        <span class="c1"># DSM: The following code is before clauseTables</span>
        <span class="c1"># DSM: because if the user uses clauseTables</span>
        <span class="c1"># DSM: (and normal string SELECT), he must know what he wants</span>
        <span class="c1"># DSM: and will do himself the relationship between classes.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tableRegistry</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">allClasses</span> <span class="o">=</span> <span class="n">classregistry</span><span class="o">.</span><span class="n">registry</span><span class="p">(</span>
                <span class="n">sourceClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span><span class="o">.</span><span class="n">allClasses</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">registryClass</span> <span class="ow">in</span> <span class="n">allClasses</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">registryClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tablesSet</span><span class="p">:</span>
                    <span class="c1"># DSM: By default, no parents are needed for the clauses</span>
                    <span class="n">tableRegistry</span><span class="p">[</span><span class="n">registryClass</span><span class="p">]</span> <span class="o">=</span> <span class="n">registryClass</span>
            <span class="n">tableRegistryCopy</span> <span class="o">=</span> <span class="n">tableRegistry</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">childClass</span> <span class="ow">in</span> <span class="n">tableRegistryCopy</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">childClass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tableRegistry</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">currentClass</span> <span class="o">=</span> <span class="n">childClass</span>
                <span class="k">while</span> <span class="n">currentClass</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">currentClass</span> <span class="ow">in</span> <span class="n">tableRegistryCopy</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">currentClass</span> <span class="ow">in</span> <span class="n">tableRegistry</span><span class="p">:</span>
                            <span class="c1"># DSM: Remove this class as it is a parent one</span>
                            <span class="c1"># DSM: of a needed children</span>
                            <span class="k">del</span> <span class="n">tableRegistry</span><span class="p">[</span><span class="n">currentClass</span><span class="p">]</span>
                        <span class="c1"># DSM: Must keep the last parent needed</span>
                        <span class="c1"># DSM: (to limit the number of join needed)</span>
                        <span class="n">tableRegistry</span><span class="p">[</span><span class="n">childClass</span><span class="p">]</span> <span class="o">=</span> <span class="n">currentClass</span>
                    <span class="n">currentClass</span> <span class="o">=</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
            <span class="c1"># DSM: Table registry contains only the last children</span>
            <span class="c1"># DSM: or standalone classes</span>
            <span class="n">parentClause</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">currentClass</span><span class="p">,</span> <span class="n">minParentClass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tableRegistry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">currentClass</span> <span class="o">!=</span> <span class="n">minParentClass</span><span class="p">)</span> \
                        <span class="ow">and</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
                    <span class="n">parentClass</span> <span class="o">=</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
                    <span class="n">parentClause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currentClass</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">parentClass</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">currentClass</span> <span class="o">=</span> <span class="n">parentClass</span>
                    <span class="n">tablesSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">table</span><span class="p">))</span>
            <span class="n">clause</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">AND</span><span class="p">,</span> <span class="n">parentClause</span><span class="p">,</span> <span class="n">clause</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSelectResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">sourceClass</span><span class="p">,</span> <span class="n">clause</span><span class="p">,</span> <span class="n">clauseTables</span><span class="p">,</span> <span class="o">**</span><span class="n">ops</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accumulateMany</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skipInherited&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSelectResults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span>\
                <span class="n">accumulateMany</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">string_type</span><span class="p">):</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">tableName</span><span class="p">)</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceClass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clause</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">clauseTables</span><span class="p">,</span> <span class="n">inheritedTables</span><span class="o">=</span><span class="n">tables</span><span class="p">,</span>
                               <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span><span class="o">.</span><span class="n">accumulateMany</span><span class="p">(</span><span class="n">skipInherited</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InheritableSQLMeta</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">addColumn</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">columnDef</span><span class="p">,</span> <span class="n">changeSchema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="c1"># DSM: Try to add parent properties to the current class</span>
        <span class="c1"># DSM: Only do this once if possible at object creation and once for</span>
        <span class="c1"># DSM: each new dynamic column to refresh the current class</span>
        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">cname</span> <span class="o">==</span> <span class="s1">&#39;childName&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">cname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">):</span>
                    <span class="n">cname</span> <span class="o">=</span> <span class="n">cname</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">cname</span><span class="p">),</span> <span class="nb">eval</span><span class="p">(</span>
                    <span class="s1">&#39;lambda self: self._parent.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cname</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">immutable</span><span class="p">:</span>
                    <span class="k">def</span> <span class="nf">make_setfunc</span><span class="p">(</span><span class="n">cname</span><span class="p">):</span>
                        <span class="k">def</span> <span class="nf">setfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">_creating</span> <span class="ow">and</span> \
                               <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="p">,</span>
                                           <span class="s2">&quot;row_update_sig_suppress&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">RowUpdateSignal</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                                                  <span class="p">{</span><span class="n">cname</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>

                            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="n">cname</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">setfunc</span>

                    <span class="n">setfunc</span> <span class="o">=</span> <span class="n">make_setfunc</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">setterName</span><span class="p">(</span><span class="n">cname</span><span class="p">),</span> <span class="n">setfunc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">childUpdate</span><span class="p">:</span>
                <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">columnDef</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLMeta</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="p">)</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">columnDef</span><span class="p">,</span>
                                                         <span class="n">changeSchema</span><span class="p">,</span>
                                                         <span class="n">connection</span><span class="p">)</span>

        <span class="c1"># DSM: Update each child class if needed and existing (only for new</span>
        <span class="c1"># DSM: dynamic column as no child classes exists at object creation)</span>
        <span class="k">if</span> <span class="n">columnDef</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">soClass</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="n">columnDef</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
                                <span class="n">childUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">columnDef</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">delColumn</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">changeSchema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">childUpdate</span><span class="p">:</span>
            <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
            <span class="n">unmakeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">column</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">soClass</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLMeta</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="p">)</span><span class="o">.</span><span class="n">delColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">changeSchema</span><span class="p">,</span>
                                                     <span class="n">connection</span><span class="p">)</span>

        <span class="c1"># DSM: Update each child class if needed</span>
        <span class="c1"># DSM: and delete properties for this column</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">delColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">changeSchema</span><span class="o">=</span><span class="n">changeSchema</span><span class="p">,</span>
                                <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">addJoin</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">joinDef</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
        <span class="c1"># DSM: Try to add parent properties to the current class</span>
        <span class="c1"># DSM: Only do this once if possible at object creation and once for</span>
        <span class="c1"># DSM: each new dynamic join to refresh the current class</span>
        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">join</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
                <span class="n">jname</span> <span class="o">=</span> <span class="n">join</span><span class="o">.</span><span class="n">joinMethodName</span>
                <span class="n">jarn</span> <span class="o">=</span> <span class="n">join</span><span class="o">.</span><span class="n">addRemoveName</span>
                <span class="nb">setattr</span><span class="p">(</span>
                    <span class="n">soClass</span><span class="p">,</span> <span class="n">getterName</span><span class="p">(</span><span class="n">jname</span><span class="p">),</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;lambda self: self._parent.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">jname</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span> <span class="o">+</span> <span class="n">jarn</span><span class="p">,</span>
                        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;lambda self,o: self._parent.remove</span><span class="si">%s</span><span class="s1">(o)&#39;</span> <span class="o">%</span> <span class="n">jarn</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="n">soClass</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span> <span class="o">+</span> <span class="n">jarn</span><span class="p">,</span>
                        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;lambda self,o: self._parent.add</span><span class="si">%s</span><span class="s1">(o)&#39;</span> <span class="o">%</span> <span class="n">jarn</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">childUpdate</span><span class="p">:</span>
                <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">joinDef</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLMeta</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="p">)</span><span class="o">.</span><span class="n">addJoin</span><span class="p">(</span><span class="n">joinDef</span><span class="p">)</span>

        <span class="c1"># DSM: Update each child class if needed and existing (only for new</span>
        <span class="c1"># DSM: dynamic join as no child classes exists at object creation)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">addJoin</span><span class="p">(</span><span class="n">joinDef</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">delJoin</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">,</span> <span class="n">joinDef</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">childUpdate</span><span class="p">:</span>
            <span class="n">soClass</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">soClass</span>
            <span class="n">unmakeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
            <span class="n">makeProperties</span><span class="p">(</span><span class="n">soClass</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLMeta</span><span class="p">,</span> <span class="n">sqlmeta</span><span class="p">)</span><span class="o">.</span><span class="n">delJoin</span><span class="p">(</span><span class="n">joinDef</span><span class="p">)</span>

        <span class="c1"># DSM: Update each child class if needed</span>
        <span class="c1"># DSM: and delete properties for this join</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">delJoin</span><span class="p">(</span><span class="n">joinDef</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getAllColumns</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">sqlmeta</span>
        <span class="k">while</span> <span class="n">sm</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">sqlmeta</span>
        <span class="k">return</span> <span class="n">columns</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getColumns</span><span class="p">(</span><span class="n">sqlmeta</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">getAllColumns</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;childName&#39;</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">columns</span><span class="p">[</span><span class="s1">&#39;childName&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">columns</span>


<div class="viewcode-block" id="InheritableSQLObject"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject">[docs]</a><span class="k">class</span> <span class="nc">InheritableSQLObject</span><span class="p">(</span><span class="n">SQLObject</span><span class="p">):</span>

    <span class="n">sqlmeta</span> <span class="o">=</span> <span class="n">InheritableSQLMeta</span>
    <span class="n">_inheritable</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">SelectResultsClass</span> <span class="o">=</span> <span class="n">InheritableSelectResults</span>

<div class="viewcode-block" id="InheritableSQLObject.set"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="n">SQLObject</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_suppress_set_sig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SQLObject</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__classinit__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">):</span>
        <span class="n">SQLObject</span><span class="o">.</span><span class="n">__classinit__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">)</span>
        <span class="c1"># if we are a child class, add sqlbuilder fields from parents</span>
        <span class="n">currentClass</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
        <span class="k">while</span> <span class="n">currentClass</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;childName&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">currentClass</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">currentClass</span> <span class="o">=</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_SO_setupSqlmeta</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">new_attrs</span><span class="p">,</span> <span class="n">is_base</span><span class="p">):</span>
        <span class="c1"># Note: cannot use super(InheritableSQLObject, cls)._SO_setupSqlmeta -</span>
        <span class="c1">#       InheritableSQLObject is not defined when it&#39;s __classinit__</span>
        <span class="c1">#       is run.  Cannot use SQLObject._SO_setupSqlmeta, either:</span>
        <span class="c1">#       the method would be bound to wrong class.</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;InheritableSQLObject&quot;</span><span class="p">:</span>
            <span class="n">call_super</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># InheritableSQLObject must be in globals yet</span>
            <span class="n">call_super</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span>
        <span class="n">call_super</span><span class="o">.</span><span class="n">_SO_setupSqlmeta</span><span class="p">(</span><span class="n">new_attrs</span><span class="p">,</span> <span class="n">is_base</span><span class="p">)</span>
        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># locate parent class and register this class in it&#39;s children</span>
        <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">superclass</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__bases__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">superclass</span><span class="p">,</span> <span class="s1">&#39;_inheritable&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="p">(</span><span class="n">superclass</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;InheritableSQLObject&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
                    <span class="c1"># already have a parent class;</span>
                    <span class="c1"># cannot inherit from more than one</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="s2">&quot;Multiple inheritance is not implemented&quot;</span><span class="p">)</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span> <span class="o">=</span> <span class="n">superclass</span>
                <span class="n">superclass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="p">[</span><span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="c1"># remove inherited column definitions</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnDefinitions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># default inheritance child name</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childName</span><span class="p">:</span>
                <span class="n">sqlmeta</span><span class="o">.</span><span class="n">childName</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="InheritableSQLObject.get"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selectResults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">childResults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">val</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span>
                                                   <span class="n">selectResults</span><span class="p">)</span>

        <span class="c1"># DSM: If we are updating a child, we should never return a child...</span>
        <span class="k">if</span> <span class="n">childUpdate</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="c1"># DSM: If this class has a child, return the child</span>
        <span class="k">if</span> <span class="s1">&#39;childName&#39;</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">childName</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">childName</span>
            <span class="k">if</span> <span class="n">childName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">childClass</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">childClasses</span><span class="p">[</span><span class="n">childName</span><span class="p">]</span>
                <span class="c1"># If the class has no columns (which sometimes makes sense</span>
                <span class="c1"># and may be true for non-inheritable (leaf) classes only),</span>
                <span class="c1"># shunt the query to avoid almost meaningless SQL</span>
                <span class="c1"># like &quot;SELECT NULL FROM child WHERE id=1&quot;.</span>
                <span class="c1"># This is based on assumption that child object exists</span>
                <span class="c1"># if parent object exists.  (If it doesn&#39;t your database</span>
                <span class="c1"># is broken and that is a job for database maintenance.)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">childResults</span> <span class="ow">or</span> <span class="n">childClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                    <span class="n">childResults</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
                <span class="k">return</span> <span class="n">childClass</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
                                      <span class="n">selectResults</span><span class="o">=</span><span class="n">childResults</span><span class="p">)</span>
        <span class="c1"># DSM: Now, we know we are alone or the last child in a family...</span>
        <span class="c1"># DSM: It&#39;s time to find our parents</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">while</span> <span class="n">inst</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="nb">id</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_parent</span>
        <span class="c1"># DSM: We can now return ourself</span>
        <span class="k">return</span> <span class="n">val</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_notifyFinishClassCreation</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">sqlmeta</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span>
        <span class="c1"># verify names of added columns</span>
        <span class="k">if</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="c1"># FIXME: this does not check for grandparent column overrides</span>
            <span class="n">parentCols</span> <span class="o">=</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;childName&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                        <span class="s2">&quot;The column name &#39;childName&#39; is reserved&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">parentCols</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                        <span class="s2">&quot;The column &#39;</span><span class="si">%s</span><span class="s2">&#39; is already defined &quot;</span>
                        <span class="s2">&quot;in an inheritable parent&quot;</span> <span class="o">%</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># if this class is inheritable, add column for children distinction</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">_inheritable</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;InheritableSQLObject&#39;</span><span class="p">):</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span>
                <span class="n">StringCol</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;childName&#39;</span><span class="p">,</span>
                          <span class="c1"># limit string length to get VARCHAR and not CLOB</span>
                          <span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
            <span class="c1"># There are no columns - call addColumn to propagate columns</span>
            <span class="c1"># from parent classes to children</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addColumn</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sqlmeta</span><span class="o">.</span><span class="n">joins</span><span class="p">:</span>
            <span class="c1"># There are no joins - call addJoin to propagate joins</span>
            <span class="c1"># from parent classes to children</span>
            <span class="n">sqlmeta</span><span class="o">.</span><span class="n">addJoin</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="c1"># DSM: If we were called by a children class,</span>
        <span class="c1"># DSM: we must retreive the properties dictionary.</span>
        <span class="c1"># DSM: Note: we can&#39;t use the ** call paremeter directly</span>
        <span class="c1"># DSM: as we must be able to delete items from the dictionary</span>
        <span class="c1"># DSM: (and our children must know that the items were removed!)</span>
        <span class="k">if</span> <span class="s1">&#39;kw&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;kw&#39;</span><span class="p">]</span>
        <span class="c1"># DSM: If we are the children of an inheritable class,</span>
        <span class="c1"># DSM: we must first create our parent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="n">parentClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
            <span class="n">new_kw</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">parent_kw</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;childName&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">parentClass</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                    <span class="n">parent_kw</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_kw</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="n">new_kw</span>

            <span class="c1"># Need to check that we have enough data to sucesfully</span>
            <span class="c1"># create the current subclass otherwise we will leave</span>
            <span class="c1"># the database in an inconsistent state.</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columnList</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">_default</span> <span class="o">==</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">NoDefault</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">foreignName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">() did not get expected keyword argument &quot;</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="n">parent_kw</span><span class="p">[</span><span class="s1">&#39;childName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">childName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parentClass</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="n">parent_kw</span><span class="p">,</span>
                                       <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="p">)</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># TC: Create this record and catch all exceptions in order to destroy</span>
        <span class="c1"># TC: the parent if the child can not be created.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># If we are outside a transaction and this is a child,</span>
            <span class="c1"># destroy the parent</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">dbconnection</span><span class="o">.</span><span class="n">Transaction</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">connection</span><span class="o">.</span><span class="n">autoCommit</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">destroySelf</span><span class="p">()</span>
                <span class="c1"># TC: Do we need to do this??</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># TC: Reraise the original exception</span>
            <span class="k">raise</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_findAlternateID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dbName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">selectBy</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">obj</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="InheritableSQLObject.select"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">clause</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">parentClass</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
        <span class="n">childUpdate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;childUpdate&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># childUpdate may have one of three values:</span>
        <span class="c1">#   True:</span>
        <span class="c1">#       select was issued by parent class to create child objects.</span>
        <span class="c1">#       Execute select without modifications.</span>
        <span class="c1">#   None (default):</span>
        <span class="c1">#       select is run by application.  If this class is inheritance</span>
        <span class="c1">#       child, delegate query to the parent class to utilize</span>
        <span class="c1">#       InheritableIteration optimizations.  Selected records</span>
        <span class="c1">#       are restricted to this (child) class by adding childName</span>
        <span class="c1">#       filter to the where clause.</span>
        <span class="c1">#   False:</span>
        <span class="c1">#       select is delegated from inheritance child which is parent</span>
        <span class="c1">#       of another class.  Delegate the query to parent if possible,</span>
        <span class="c1">#       but don&#39;t add childName restriction: selected records</span>
        <span class="c1">#       will be filtered by join to the table filtered by childName.</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">childUpdate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">parentClass</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">childUpdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># this is the first parent in deep hierarchy</span>
                <span class="n">addClause</span> <span class="o">=</span> <span class="n">parentClass</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">childName</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">childName</span>
                <span class="c1"># if the clause was one of TRUE varians, replace it</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">clause</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">clause</span> <span class="ow">is</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLTrueClause</span><span class="p">)</span> \
                        <span class="ow">or</span> <span class="p">(</span>
                            <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">string_type</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="p">(</span><span class="n">clause</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">)):</span>
                    <span class="n">clause</span> <span class="o">=</span> <span class="n">addClause</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># patch WHERE condition:</span>
                    <span class="c1"># change ID field of this class to ID of parent class</span>
                    <span class="c1"># XXX the clause is patched in place; it would be better</span>
                    <span class="c1">#     to build a new one if we have to replace field</span>
                    <span class="n">clsID</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">id</span>
                    <span class="n">parentID</span> <span class="o">=</span> <span class="n">parentClass</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">id</span>

                    <span class="k">def</span> <span class="nf">_get_patched</span><span class="p">(</span><span class="n">clause</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLOp</span><span class="p">):</span>
                            <span class="n">_patch_id_clause</span><span class="p">(</span><span class="n">clause</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">None</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">tableName</span> <span class="o">==</span> <span class="n">clsID</span><span class="o">.</span><span class="n">tableName</span><span class="p">)</span> \
                                <span class="ow">and</span> <span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">fieldName</span> <span class="o">==</span> <span class="n">clsID</span><span class="o">.</span><span class="n">fieldName</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">parentID</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span>

                    <span class="k">def</span> <span class="nf">_patch_id_clause</span><span class="p">(</span><span class="n">clause</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">SQLOp</span><span class="p">):</span>
                            <span class="k">return</span>
                        <span class="n">expr</span> <span class="o">=</span> <span class="n">_get_patched</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">expr1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">expr</span><span class="p">:</span>
                            <span class="n">clause</span><span class="o">.</span><span class="n">expr1</span> <span class="o">=</span> <span class="n">expr</span>
                        <span class="n">expr</span> <span class="o">=</span> <span class="n">_get_patched</span><span class="p">(</span><span class="n">clause</span><span class="o">.</span><span class="n">expr2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">expr</span><span class="p">:</span>
                            <span class="n">clause</span><span class="o">.</span><span class="n">expr2</span> <span class="o">=</span> <span class="n">expr</span>
                    <span class="n">_patch_id_clause</span><span class="p">(</span><span class="n">clause</span><span class="p">)</span>
                    <span class="c1"># add childName filter</span>
                    <span class="n">clause</span> <span class="o">=</span> <span class="n">sqlbuilder</span><span class="o">.</span><span class="n">AND</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">addClause</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parentClass</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="n">childUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">clause</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="InheritableSQLObject.selectBy"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject.selectBy">[docs]</a>    <span class="k">def</span> <span class="nf">selectBy</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">clause</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">foreignColumns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">currentClass</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="k">while</span> <span class="n">currentClass</span><span class="p">:</span>
            <span class="n">foreignColumns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">column</span><span class="o">.</span><span class="n">foreignName</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="ow">in</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">column</span><span class="o">.</span><span class="n">foreignKey</span>
                 <span class="p">]))</span>
            <span class="n">currentClass</span> <span class="o">=</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">foreignColumns</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">foreignColumns</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># translate &quot;key&quot; to &quot;keyID&quot;</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SQLObject</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span>
            <span class="n">currentClass</span> <span class="o">=</span> <span class="n">cls</span>
            <span class="k">while</span> <span class="n">currentClass</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">clause</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">currentClass</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">currentClass</span> <span class="o">=</span> <span class="n">currentClass</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; instance has no attribute &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">clause</span><span class="p">:</span>
            <span class="n">clause</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">sqlbuilder</span><span class="o">.</span><span class="n">AND</span><span class="p">,</span> <span class="n">clause</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clause</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># select all</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">cls</span><span class="o">.</span><span class="n">_connection</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">SelectResultsClass</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">clause</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="InheritableSQLObject.destroySelf"><a class="viewcode-back" href="../../api/sqlobject.inheritance.html#sqlobject.inheritance.InheritableSQLObject.destroySelf">[docs]</a>    <span class="k">def</span> <span class="nf">destroySelf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># DSM: If this object has parents, recursivly kill them</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_parent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">destroySelf</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">destroySelf</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_reprItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InheritableSQLObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_reprItems</span><span class="p">()</span>
        <span class="c1"># add parent attributes (if any)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlmeta</span><span class="o">.</span><span class="n">parentClass</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_reprItems</span><span class="p">())</span>
        <span class="c1"># filter out our special column</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;childName&#39;</span><span class="p">]</span></div>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;InheritableSQLObject&#39;</span><span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SQLObject 3.2.0a0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2017, Ian Bicking and contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>